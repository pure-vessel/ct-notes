\documentclass{article}
\input{Headers/header}
\input{Headers/formal}
\input{Headers/graphs}

\fancyhead[L]{Дискретная математика}

\begin{document}
    \tableofcontents\pagebreak
    \section{Теория графов.}
    \paragraph{Основные определения теории графов.}
    \begin{definition}
        \textbf{(Неориентированным) графом} называется пара из множеств $V$ и $E$, где $E\subset V\times V\setminus\{(u;u)\mid u\in V\}/_{(u;v)\sim(v;u)}$.
    \end{definition}
    \begin{definition}
        \textbf{(Неориентированным) графом с кратными рёбрами} называется набор множеств $V$, $E$ и функции $\mathrm{ends}\colon E\to A\subset 2^X$, где $A=\{B\subset V\mid |B|=2\}$, определяющей концы ребра. При этом 
    \end{definition}
    \begin{definition}
        \textbf{(Неориентированным) графом с кратными рёбрами и петлями} называется то же самое, что и в предыдущем определении, но $1\leqslant|B|\leqslant2$.
    \end{definition}
    \begin{definition}
        \textbf{(Неориентированным) графом с петлями} называется пара из множеств $V$ и $E$, где $E\subset V\times V/_{(u;v)\sim(v;u)}$.
    \end{definition}
    \begin{definition}
        \textbf{Ориентированным графом (с петлями)} называется пара из множеств $V$ и $E\subset V\times V$.
    \end{definition}
    \begin{definition}
        \textbf{Ориентированным графом с кратными рёбрами (и петлями)} называется набор из множеств $V$ и $E$ и двух функций $\mathrm{beg}\colon E\to V$, $\mathrm{end}\colon E\to V$.
    \end{definition}
    \begin{definition}
        Говорят, что ребро и вершина в графе \textbf{инцидентны}, если одним из концов/началом или концом ребра является вершина.
    \end{definition}
    \begin{definition}
        Количество рёбер, с которыми данная вершина инцидентна, называется \textbf{степенью вершины} ($\deg u$). Если разрешены кратные рёбра, считается, что они вносят два в степень, а не один.
    \end{definition}
    \begin{lemma}[Лемма о рукопожатиях.]
        Тривиально,
        $$
        \sum\limits_{u\in V}\deg u=2|E|
        $$
    \end{lemma}
    \begin{definition}
        Количество рёбер, исходящих из данной вершины, называется \textbf{исходящей степенью} ($\deg^-u$ или $\deg_{\mathrm{out}}u$).
    \end{definition}
    \begin{definition}
        Количество рёбер, исходящих из данной вершины, называется \textbf{входящей степенью} ($\deg^+u$ или $\deg_{\mathrm{in}}u$).
    \end{definition}
    \begin{lemma}
        Тривиально,
        $$
        \sum\limits_{u\in V}\deg^+u+\deg^-u=2|E|
        $$
    \end{lemma}
    \paragraph{Связность. Сильная связность. Двусвязность.}
    \begin{definition}
        Последовательность
        $$
        u_0;e_1;u_1;e_2;u_2;\ldots;e_k;u_k
        $$
        где $\forall i\in[0:k]~u_i\in V$, $\forall j\in[1:k]~e_j\in E$ и $\forall i\in[1:k]~u_{i-1}$ и $u_i$ инцидентны $e_i$ называется \textbf{путём} (в неориентированном графе). $k$ называется \textbf{длиной пути}.
    \end{definition}
    \begin{definition}
        Сами допилите напильником предыдущее определение до определения \textbf{пути в ориентированном графе}.
    \end{definition}
    \begin{definition}
        {\large В неориентированном графе}\\
        Циклическим путём называется путь, у которых начало совпадает с концом и длина больше нуля.\\
        Циклические пути называются эквивалентными, если они совпадают с точностью до циклического сдвига.\\
        Классы эквивалентности циклический путей по данной эквивалентности называются \textbf{циклами}.
    \end{definition}
    \begin{definition}
        Путь или цикл в ориентированном графе называется \textbf{рёберно простым}/\textbf{вершинно простым}, если все $e_i$/$v_i$ соотвественно различны.
    \end{definition}
    \begin{definition}
        {\large В ориентированном графе}\\
        Циклическим путём называется путь, у которых начало совпадает с концом и длина больше нуля.\\
        Циклический путь называется корректным, если $\forall i\in[1:k-1]~e_i\neq e_{i+1}$, если $e_i$ не петля и $e_1\neq e_k$, если $e_1$~--- не петля.\\
        Корректные циклические пути называются эквивалентными, если они совпадают с точностью до циклического сдвига и/или отражения.\\
        Классы эквивалентности корректных циклический путей по данной эквивалентности называются \textbf{циклами}.
    \end{definition}
    \begin{definition}
        Путь или цикл в неориентированном графе называется \textbf{рёберно простым}/\textbf{вершинно простым}, если догадайтесь, когда.
    \end{definition}
    \begin{definition}
        Говорят, что $v$ \textbf{достижима} из $u$ ($u\leadsto v$), если существует путь из $u$ в $v$.
    \end{definition}
    \begin{claim}
        Достижимость рефлексивна и транзитивна. В неориентированном графе также симметрична.
    \end{claim}
    \begin{definition}
        Отношение $u\leadsto v\land v\leadsto u$ называется \textbf{отношением сильной связности}.
    \end{definition}
    \begin{claim}
        Отношение сильной связности симметрично.
    \end{claim}
    \begin{definition}
        В неориентированном графе классы эквивалентности по достижимости называются \textbf{компонентами связности}.
    \end{definition}
    \begin{definition}
        В ориентированном графе классы эквивалентности по сильной связности называются \textbf{компонентами сильной связности}.
    \end{definition}
    \begin{definition}
        \textbf{Конденсацией} ориентированного графа называется граф, получаемый из ориентированного графа заменой компонент сильной связности на вершины с сохранением ориентированных рёбер.
    \end{definition}
    \begin{claim}
        Конденсация всегда не содержит циклов.
    \end{claim}
    \begin{definition}
        В неориентированном графе $u,v\in V$ называются рёберно двусвязными, если существуют два пути из $u$ в $v$, не имеющие общих рёбер.
    \end{definition}
    \begin{claim}
        Рёберная двусвязность является отношением эквивалентности.
    \end{claim}
    \begin{proof}
        \begin{itemize}
            \item Рефлексивность: возьмём 2 одинаковых пути из вершины в себя. Они не пересекаются по рёбрам.
            \item Симметричность: очевидно.
            \item Транзитивность. Пусть $u$ двусвязана с $v$, а $v$~--- с $w$. Рассмотрим $p_1$ и $p_2$~--- два пути из $u$ в $v$. Давайте теперь возьмём $w$ и будем из неё идти в сторону $v$ по путям $q_1$ и $q_2$.
            \begin{itemize}
                \item Если мы дошли без пересечения с $p_1$ или $p_2$, мы победили.
                \item Если мы по одному пути пересеклись с $p_1$, а по другому~--- с $p_2$, мы победили.
                \item Если мы пришли на один и тот же путь, то от одного из $q_1$ и $q_2$ пойдём в сторону $u$, а от другого~--- в сторону $v$. В сторону $v$~--- от того, которого ближе. После этого из второго пойдём и $v$ в $u$ по второму пути между ними. Мы победили.
            \end{itemize}
        \end{itemize}
    \end{proof}
    \begin{definition}
        Классы эквивалентности по рёберной двусвязности называются \textbf{компонентами рёберной двусвязности} или \textbf{листами}.
    \end{definition}
    \begin{definition}
        Ребро, концы которого не являются рёберно двусвязными,~--- \textbf{мост}.
    \end{definition}
    \begin{definition}
        Ребро, при удалении которого, количество компонент связности увеличивается,~--- \textbf{мост}.
    \end{definition}
    \begin{theorem}
        Следующие 4 утверждения для связного графа (и первые 3 для несвязного) равносильны.
        \begin{enumerate}
            \item $uv$~--- мост в смысле первого определения.
            \item $uv$~--- мост в смысле второго определения.
            \item $\exists x,y\in V$ любой путь из $x$ в $y$ содержит $uv$.
            \item $V=X\sqcup Y$, $X\neq\varnothing\neq Y$ такие что $\forall x\in X~\forall y\in Y$ любой путь из $x$ в $y$ содержит $uv$.
        \end{enumerate}
    \end{theorem}
    \begin{proof}
        \begin{itemize}
            \item[$1\to2$] Если при удалении количество компонент связности не увеличится, был другой путь $u\leadsto v$. Противоречие.
            \item[$2\to4$] Возьмём в качестве $X$ и $Y$ те две (а тривиально, что в связном графе их две) компоненты связности, на которые развалится наш граф. Всё.
            \item[$4\to3$] Тривиально.
            \item[$3\to1$] Если $u$ и $v$ рёберно двусвязны, то от $x$ до $y$ можно пройти другим путём, игнорируя $uv$.
        \end{itemize}
        Для несвязного графа справьтесь сами.
    \end{proof}
    \begin{example}
        Жирным выделены мосты, цифрами помечены компоненты рёберной двусвязности.
        \begin{figure}[H]
            \begin{tikzpicture}
                \graph[spring electrical layout,node distance=1.5cm,node sep=0mm,nodes={treenode,outer sep=0mm}]{
                    1[as=1] -- 2[as=1] -- 3[as=1] -- 1, 2 -- 4[as=1] -- 3,
                    3 --[very thick] 5[as=2] --[very thick] 6[as=3] --[very thick] 7[as=4],
                    6 -- 8[as=3] -- 9[as=3] -- 6,
                    9 --[very thick] 10[as=5] -- 11[as=5] -- 12[as=5] -- 10, 
                };
            \end{tikzpicture}
        \end{figure}\noindent
    \end{example}
    \begin{definition}
        Два ребра $ab$ и $cd$ называются вершинно двусвязными, если между существуют два вершинно непересекающихся пути $a\leadsto c$ и $b\leadsto d$ (или, наоборот, $a\leadsto d$ и $b\leadsto c$).
    \end{definition}
    \begin{theorem}
        В неориентированном графе без петель вершинная двусвязность является отношением эквивалентности.
    \end{theorem}
    \begin{proof}
        \begin{itemize}
            \item Рефлексивность: очевидно.
            \item Симметричность: очевидно.
            \item Транзитивность: та же заплатка, что и в рёберной двусвязности.
        \end{itemize}
    \end{proof}
    \begin{definition}
        Классы эквивалентности по вершинной двусвязности называются \textbf{компонентами вершинной двусвязности} или \textbf{блоками}.
    \end{definition}
    \begin{definition}
        \textbf{Точкой сочленения} называется вершина, принадлежащая нескольким компонентам вершинной двусвязности.
    \end{definition}
    \begin{definition}
        \textbf{Точкой сочленения} называется вершина, удаление которой (вместе с инцидентными рёбрами) приводит к увеличению компонент связности.
    \end{definition}
    \begin{theorem}
        Сами докажите, что следующие 4 утверждения для связного графа (и первые 3 для несвязного) равносильны.
        \begin{enumerate}
            \item $v$~--- точка сочленения в смысле первого определения.
            \item $v$~--- точка сочленения в смысле второго определения.
            \item $\exists x,y\in V:x\neq v\neq y$ любой путь из $x$ в $y$ содержит $v$.
            \item $V=X\sqcup Y$, $X\neq\varnothing\neq Y$ такие что $\forall x\in X~\forall y\in Y$ любой путь из $x$ в $y$ содержит $v$.
        \end{enumerate}
    \end{theorem}
    \begin{definition}
        \textbf{Дерево блоков~--- точек сочленения}~--- это граф, получаемый из графа заменой блоков на отдельные вершины, добавлением по каждой вершине для точки сочленения и рёбрами, показывающими отношение <<содержать данную точку сочленения>>.
    \end{definition}
    \begin{example}
        \begin{multicols}{2}
            Некоторый граф; обведены компоненты вершинной двусвязности, закрашены вершины, состоящие хотя бы в двух.
            \begin{figure}[H]
                \begin{tikzpicture}
                    \graph[spring layout,node distance=1.5cm,node sep=0mm,nodes={treenode,outer sep=0mm,text width=1.5mm,as=}]{
                        1 -- 2 -- 3 -- 1, 2 -- 4[fill=black] -- 3,
                        4 -- 5,
                        4 -- 6 -- 7[fill=black] -- 4,
                        7 -- 8[fill=black] -- 9[fill=black] -- 10 -- 11 -- 9, 10 -- 12 -- 11,
                        8 -- 13[fill=black] -- 14[fill=black] -- 15 -- 13,
                        14 -- 16[fill=black] -- {17, 18},
                    };
                    \draw[red, opacity=.75] \convexpath{9,10,12,11}{2mm};
                    \draw[darkgreen, opacity=.75] \convexpath{8,9}{2mm};
                    \draw[red, opacity=.75] \convexpath{8,13}{2mm};
                    \draw[darkgreen, opacity=.75] \convexpath{13,14,15}{2mm};
                    \draw[red, opacity=.75] \convexpath{14,16}{2mm};
                    \draw[darkgreen, opacity=.75] \convexpath{16,17}{2mm};
                    \draw[blue, opacity=.75] \convexpath{16,18}{2mm};
                    \draw[blue, opacity=.75] \convexpath{8,7}{2mm};
                    \draw[red, opacity=.75] \convexpath{7,6,4}{2mm};
                    \draw[darkgreen, opacity=.75] \convexpath{5,4}{2mm};
                    \draw[blue, opacity=.75] \convexpath{1,2,4,3}{2mm};
                \end{tikzpicture}
            \end{figure}
            \columnbreak
            Дерево блоков~--- точек сочленения графа слева.
            \begin{figure}[H]
                \begin{tikzpicture}
                    \graph[spring layout,node distance=1.5cm,node sep=0mm,nodes={treenode,outer sep=0mm,text width=1.5mm,as=}]{
                        1234[draw=blue] -- 4[fill=black] -- 45[draw=darkgreen],
                        4 -- 467[draw=red] -- 7[fill=black],
                        7 -- 78[draw=blue] -- 8[fill=black] -- 89[draw=darkgreen] -- 9[fill=black] -- 9101112[draw=red],
                        8 -- 813[draw=red] -- 13[fill=black] -- 131415[draw=darkgreen] -- 14[fill=black],
                        14 -- 1416[draw=red] -- 16[fill=black] -- {1617[draw=darkgreen], 1618[draw=blue]},
                    };
                \end{tikzpicture}
            \end{figure}
        \end{multicols}
    \end{example}
    \paragraph{Деревья. Остовные деревья.}
    \begin{definition}
        Неориентированный граф называется \textbf{лесом}, если в нём нет циклов.
    \end{definition}
    \begin{definition}
        Связный лес называется \textbf{деревом}.
    \end{definition}
    \begin{definition}
        Вершина степени 1 в лесе называется \textbf{листом}.
    \end{definition}
    \begin{lemma}
        Дерево с хотя бы двумя вершинами содержит лист.
    \end{lemma}
    \begin{proof}
        Рассмотрим некоторую вершину $u_1$. Если это не лист, возьмём случайного её соседа $u_2$, перейдём в него. Если это лист, мы победили. Если нет, есть хотя бы 2 соседа. Из одного мы пришли, пойдём во второго ($u_3$). Рано или поздно мы либо найдём лист, либо придём в вершину, где уже были. Во втором случае мы нашли цикл, значит такого не бывает.
    \end{proof}
    \begin{theorem}
        Следующие три утверждения равносильны:
        \begin{enumerate}
            \item $G$~--- связный граф без циклов.
            \item $G$~--- связный граф с $n$ вершинами и $n-1$ ребром.
            \item $G$~--- ациклический граф с $n$ вершинами и $n-1$ ребром.
        \end{enumerate}
    \end{theorem}
    \begin{proof}
        \begin{itemize}
            \item[$1\Rightarrow2$] Докажем по индукции. В дереве на 1 вершину всё выполнено. Переход. рассмотрим граф на $n+1$ вершину. Хочется доказать, что там $n$ рёбер. Давайте рассмотрим наше дерево, найдём лист и вырежем его. Получится дерево на $n$ вершин, по предположению в нём $n-1$ ребро, а одно ребро из исходного мы вырезали, значит там их было $n$.
            \item[$2\Rightarrow3$] Если в графе $n$ вершин и $n-1$ ребро, то в нём есть вершина степени не больше одного (иначе сумма всех степеней вершин $\geqslant 2n$, значит рёбер $\geqslant\frac{2n}2=n$). У нас граф связен, поэтому вершина степени 0 там может быть только если $n=1$. А теперь можно доказать по индукции, что в графе нет циклов (таким же методом, как предыдущее).
            \item[$3\Rightarrow1$] Пусть у нас $k$ компонент связности. Каждая из них~--- ациклический связный граф, то есть дерево, в котором $m$ вершин и $m-1$ ребро. Просуммировав это по всем компонентам, получим суммарно $n$ вершин и $n-k$ рёбер, то есть $k=1$.
        \end{itemize}
    \end{proof}
    \begin{lemma}
        Дерево с хотя бы двумя вершинами содержит хотя бы два листа.
    \end{lemma}
    \begin{proof}
        В противном случае суммарная степень вершин слишком велика.
    \end{proof}
    \begin{claim}
        Разные тривиальные утверждения о том, что в дереве каждое ребро~--- мост (и если в графе каждое ребро~--- мост, то это лес), о том, что в дереве от любой вершины до любой есть ровно один путь, и все подобные сами найдите и докажите.
    \end{claim}
    \begin{definition}
        Пусть $G$~--- граф. Дерево $T$ с тем же множеством вершин и $ET\subset EG$ называется \textbf{остовным деревом} $G$.
    \end{definition}
    \begin{lemma}
        У любого связного графа есть остовное дерево.
    \end{lemma}
    \begin{proof}
        Рассмотрим граф. Из всех его связных подграфов выберем тот, у которого минимальное количество рёбер. Если рёбер там больше $n-1$, там есть циклы, из них можно вырезать рандомное ребро без потери связности. Значит рёбер там ровно $n-1$, и это дерево.
    \end{proof}
    \begin{remark}
        На алгоритмах мы будем искать остовное дерево минимального веса, а тут мы хотим рассмотреть задачу вычисления количества остовных деревьев.
    \end{remark}
    \begin{example}
        Например, сколько деревьев тут?
        \begin{figure}[H]
            \begin{tikzpicture}
                \graph[simple necklace layout,node distance=1.5cm,node sep=0mm,nodes={treenode,outer sep=0mm,text width=1.5mm,as=}]{
                    1 -- 2 -- 3 -- 4 -- 1, 1 -- 3
                };
            \end{tikzpicture}
        \end{figure}\noindent
        Ну, 8. А вообще есть такой алгоритм:
    \end{example}
    \begin{definition}
        \textbf{Матрицей Кирхгофа} графа $G$ называется матрица $K(G)$, равная
        $$
        \matr{
            \deg u_1 & 0 & 0 & \cdots & 0\\
            0 & \deg u_2 & 0 & \cdots & 0\\
            0 & 0 & \deg u_3 & \cdots & 0\\
            \vdots & \vdots & \vdots & \ddots & \vdots\\
            0 & 0 & 0 & \cdots & \deg u_n\\
        }-AG
        $$
        Где $AG$~--- матрица смежности $G$.
    \end{definition}
    \begin{example}
        Например, для графа
        \begin{figure}[H]
            \begin{tikzpicture}
                \graph[simple necklace layout,node distance=1.5cm,node sep=0mm,nodes={treenode,outer sep=0mm}]{
                    1 -- 2 -- 3 -- 4 -- 1, 1 -- 3
                };
            \end{tikzpicture}
        \end{figure}\noindent
        матрица Кирхгофа выглядит как
        $$
        \matr{
            3 & -1 & -1 & -1\\
            -1 & 2 & -1 & 0\\
            -1 & -1 & 3 & -1\\
            -1 & 0 & -1 & 2
        }
        $$
    \end{example}
    \begin{theorem}[Теорема Кирхгофа]
        \label{Теорема Кирхгофа}
        Количество остовных деревьев в графе равно алгебраическому дополнению любого элемента матрицы Кирхгофа.\\
        Во-первых, мы не будем доказывать эту теорему в общем виде, а докажем для алгебраического пополнения диагональных элементов. Во-вторых, делать мы то будем \hyperref[Доказательство теоремы Кирхгофа]{немного потом}, для доказательства нам надо будет ввести несколько новых сущностей.
    \end{theorem}
    \begin{definition}
        Пусть $G$~--- граф из $m$ рёбер и $n$ вершин. Тогда \textbf{матрицей инцидентности} $G$ называется матрица $B$ размерности $n\times m$, где в столбце, отвечающем за ребро $uv$ находятся единицы в строках номер $u$ и $v$ и нули в остальных строках.
    \end{definition}
    \begin{remark}
        Вообще матрица инцидентности~--- интересная штука. Например, давайте рассмотрим её как матрицу над $\mathbb F_2$. Что тогда происходит, если мы решим уравнение $Bx=0$? Ну, умножение её на вектор~--- сложение некоторых столбцов $B$ по модулю 2. То есть мы берём набор рёбер, и там во всех вершинах степень получается чётной.
    \end{remark}
    \begin{definition}
        Множество наборов рёбер, в которых степень каждой вершины степень чётна (т.е. $\ker B$ над $\mathbb F_2$, по сути) называется \textbf{циклическим пространством графа}.
    \end{definition}
    \begin{definition}
        Пусть $T$~--- остовное дерево $G$, $uv\notin T$. Тогда рассмотрим $T\cup uv$. Тривиально, полученный граф содержит ровано один цикл, который называется \textbf{фундаментальным циклом относительно $uv$}.
    \end{definition}
    \begin{theorem}
        Фундаментальные циклы образуют базис циклического пространства.
    \end{theorem}
    \begin{proof}
        Тривиально, они все линейно независимы (в каждом есть ровно одно ребро не из дерева, у каждого своё).\\
        Теперь докажем, что эта система порождающая. Рассмотрим $X\in\ker B$. Если $X\neq0$, то в нём, тривиально, есть цикл, а значит есть ребро не из $T$. Возможно, несколько. Так вот, давайте рассмотрим все фундаментальные циклы для каждого такого ребра и возьмём их сумму. Теперь нам надо доказать, что мы получили именно что $X$. Понятно, что все рёбра не из $T$ будут взяты 1 раз, как нам и хочется. Теперь посмотрим на рёбра $T$. Нам надо, чтобы в нём рёбра из $X$ были, а рёбер не из $X$ не было. Ну, подвесим $T$. и рассмотрим какое-то ребро $e\in T$. Если $e\in X$, то (поскольку степени всех вершин $X$ чётны) из поддерева $e$ выходит нечётное количество рёбер. То есть именно в нечётном количестве фундаментальных циклов состоит $e$, а значит оно в сумме этих циклов есть. Если же $e\notin X$, то, аналогично, циклов будет чётное количество, а значит в сумме $e$ лежать не будет.
    \end{proof}
    \begin{remark}
        Вернёмся к теореме Кирхгофа.
    \end{remark}
    \begin{definition}
        Пусть $G$~--- неориентированный граф. Тогда его \textbf{ориентацией} ($\vec G$) называется ориентированный граф, вершины которого~--- это вершины $G$, а каждое ребро является ребром $G$, ориентированным в одну из двух сторон.
    \end{definition}
    \begin{definition}
        \textbf{Матрицей инцидентности ориентированного графа} называется такая матрица $\vec B$ размерности $n\times m$, что в столбце, отвечающем за ребро $\vec{uv}$ находится единица в строке номер $v$, минус единица в строке номер $u$ и нули во всех остальных строках.
    \end{definition}
    \begin{lemma}
        Пусть $\vec G$~--- произвольная ориентация $G$. Тогда $\vec B\vec B^T=K$.
    \end{lemma}
    \begin{proof}
        Рассмотрим скалярное произведение строки $\vec B$ на столбец $\vec B^T$.
        \begin{itemize}
            \item Если они имеют одинаковый номер, то в этом скалярном произведении умножается 1 на 1 для каждого входящего ребра и $-1$ на $-1$ для исходящего. То есть суммируется столько единиц, сколько рёбер, инцидентной с данной вершиной, то есть $(\vec B\vec B^T)_{i,i}=\deg i$, как и надо.
            \item Теперь пусть мы взяли $i$-тую строку и $j$-тый столбец. Ну, смотрите. Если $i$ и $j$ не соединены ребром, то на одном и том же месте в $i$-той и $j$-той строках $\vec B$ в одинаковом месте не может быть двух не-нулей (иначе получится, что $i$-тая и $j$-тая вершина инцидентны одному ребру, а они нет). То есть в таком случае $(\vec B\vec B^T)_{i,j}=0$. Если же $i$ и $j$ связаны ребром, то у него один конец в $i$-той строке $\vec B$, в другой~--- в $j$-той, и в скалярном произведении получим $-1$. А ровно это нам и надо.
        \end{itemize}
    \end{proof}
    \begin{lemma}
        $$
        K_{\cancel{u}}^{\cancel{v}}={\vec B}_{\cancel u}{{\vec B}^T}^{\cancel{v}}
        $$
        То есть если выкинуть $u$-тую строку из $\vec B$ и $v$-тый столбец из $\vec B^T$, то их произведение будет давать $K$ без $u$-той строки и $v$-того столбца.
    \end{lemma}
    \begin{proof}
        Доказательство как в предыдущей лемме.
    \end{proof}
    \begin{lemma}
        \label{Лемма об условии на дерево через матрицу}
        Рассмотрим $\vec B$. Рассмотрим любые $n-1$ столбцов и любые $n-1$ строк. Получим матрицу $Q$ размерности $(n-1)\times(n-1)$. Тогда $\det Q$ равен нулю, если в исходном графе выбранные нами столбцы соответствовали рёбрам, содержащим цикл (в $G$) и $\pm1$ иначе.
    \end{lemma}
    \begin{proof}
        Обозначим множество оставшихся рёбер за $EQ$, а вершину, которую мы вычеркнули,~--- за $u$.
        \begin{itemize}
            \item Если $EQ$ содержит цикл, то граф, тривиально, не связен. Рассмотрим компоненту связности, не содержащую $u$. В ней сумма столбцов равна нулю, и хорошо. Ну, как хорошо. Вообще $EQ$ может не содержать ориентированного цикла, но содержать цикл $G$. Так вот, в таком случае нам придётся взять не сумму соответствующих столбцов, а алгебраическую сумму, где неправильно направленные рёбра идут с коэффициентом $-1$. Тогда мы получим-таки наш ноль, то есть линейная комбинация столбцов будет равна нулю, следовательно определитель нулевой.
            \item Теперь пусть циклов там нет. Тогда там дерево (нет циклов и $n-1$ ребро). Оно содержит 2 листа. Один из них~--- не $u$. Обзовём его $v_1$. Поскольку мы считаем определок, нам разрешают переставлять строки и столбцы матрицы: давайте возьмём строку $v_1$, в ней где-то ровно одна $\pm1$. Переместим строку на первое место, а $\pm1$~--- в первый столбец, после чего забудем о $v_1$. Оставшаяся часть~--- дерево, в нём есть два листа, один~--- не $u$, возьмём его как $v_2$. Так сделаем до посинения, получим нижне-треугольную матрицу с $\pm1$ на диагонали.
        \end{itemize}
    \end{proof}
    \begin{claim}[Формула Коши~--- Бине]
        Пусть $A$~--- матрица $r\times s$, $B$~--- матрица $s\times r$, $s\geqslant r$. Тогда
        $$
        \det(AB) = \sum\limits_{1\leqslant i_1\leqslant i_2\leqslant\cdots\leqslant i_r\leqslant s}\det A^{[i_1;\ldots;i_r]}\det B_{[i_1;\ldots;i_r]}
        $$
        Напомню, что $A^{[i_1;\ldots;i_r]}$~--- минор матрицы $A$, где выбраны столбцы $i_1;\ldots;i_r$, а $B_{[i_1;\ldots;i_r]}$~--- минор $B$,  где выбраны строки $i_1;\ldots;i_r$.\\
        Доказывать формулу мы не будем, желающие могут ознакомиться с её доказательством в любом учебнике линейной алгебры.
    \end{claim}
    \begin{remark}
        Наконец-то докажем \hyperref[Теорема Кирхгофа]{теорему Кирхгофа}. Как и было анонсировано, только для алгебраических дополнений диагональных элементов.
    \end{remark}
    \begin{proof}
        \label{Доказательство теоремы Кирхгофа}
        $$
        \det K_{\cancel{u}}^{\cancel{u}}=\det({\vec B}_{\cancel u}{{\vec B}^T}^{\cancel u})=\sum\limits_{1\leqslant i_1\leqslant\cdots\leqslant i_r\leqslant n-1}\det{\vec B}_{\cancel u}^{[i_1;\ldots;i_{n-1}]}\det{{\vec B}^T}^{\cancel u}_{[i_1;\ldots;i_{n-1}]}
        $$
        Ну, и что у нас получается? Мы перебираем все возможные наборы из $n-1$ ребра. Если набор соответствует дереву, по лемме \ref{Лемма об условии на дерево через матрицу}, $\det{\vec B}_{\cancel u}^{[i_1;\ldots;i_{n-1}]}=\pm1$, а значит ровно тому же равно $\det{{\vec B}^T}^{\cancel u}_{[i_1;\ldots;i_{n-1}]}$, и мы получаем вклад в сумму в виде единицы. Если же дереву рёбра не соответствуют, получаем ноль. Итого именно количество остовных деревьев.
    \end{proof}
    \paragraph{Эйлеровы и гамильтоновы пути и циклы.}
    \begin{definition}
        \textbf{Эйлеровым циклом/путём} называется цикл/путь, проходящий по каждому ребру ровно 1 раз.
    \end{definition}
    \begin{definition}
        \textbf{Гамильтоновым циклом/путём} называется цикл/путь, проходящий по каждой вершине ровно 1 раз.
    \end{definition}
    \begin{remark}
        С эйлеровым циклом и путём есть простой, линейный по времени алгоритм, который строит эту конструкцию (почитайте АиСД). С гамильтоновым же циклом/путём всё очень плохо. Даже для довольно узких классов графов эта задача NP-полна.
    \end{remark}
    \begin{remark}
        На существование эйлерова цикла/путь не влияют изолированные вершины, поэтому отсюда и далее во всех утверждениях про эйлеровость будем игнорировать таковые.
    \end{remark}
    \begin{definition}
        Граф называется \textbf{эйлеровым}/\textbf{полуэйлеровым}/\textbf{гамильтоновым}/\textbf{полугамильтоновым}, когда в нём есть эйлеров цикл/эйлеров путь/гамильтонов путь/гамильтонов цикл.
    \end{definition}
    \begin{remark}
        Пустые графы могут считаться как эйлеровыми, так и нет. Мы будем когда как.
    \end{remark}
    \begin{theorem}
        Неориентированный связный граф является эйлеровым тогда и только тогда, когда степени всех его вершин чётны.
    \end{theorem}
    \begin{proof}
        Индукция по количеству рёбер. Если их 0, то в данной теореме мы будем считать такой граф эйлеровым.\\
        Переход. Степень каждой вершины 2, значит в графе есть какий-то цикл. Возьмём его, и вырежем из графа все его рёбра. Граф развалится на какие-то компоненты связности, давайте для всех непустых выпишем эйлеров цикл компоненты связности. Склеим эти циклы с вырезанным в начале, получим эйлеров цикл для всего графа.\\
        В обратную сторону очевидно.
    \end{proof}
    \begin{claim}
        Граф содержит эйлеров путь тогда и только тогда, когда он связен и в нём не более 2 вершин нечётной степени.
    \end{claim}
    \begin{proof}
        Если вершин нечётной степени 0, разрежем эйлеров цикл по случайной вершине, получим путь. Одна вершина нечётной степени быть не может. Если их две, соединим их, в полученном графе построим цикл, удалим ребро. В доказательстве теоремы об эйлеровом цикле мы не опирались на отсутствие кратных рёбер, так что всё хорошо.\\
        В обратную сторону, опять же, очевидно.
    \end{proof}
    \begin{claim}
        Связный граф с $2k$ вершинами нечётной степени можно разбить на $\max\{1;k\}$ рёберно-непересекающихся путей рёберно простых путей.
    \end{claim}
    \begin{theorem}
        Ориентированный слабо связный граф содержит эйлеров цикл, если для любой вершины входящая степень равна исходящей.
    \end{theorem}
    \begin{proof}
        Аналогично теореме для неориентированных графов.
    \end{proof}
    \begin{remark}
        Сами сформулируйте аналоги утверждений про эйлеров путь и разбиение на пути для ориентированных графов.
    \end{remark}
    \begin{remark}
        Отсюда и дальше в критериях гамильтоновости считаем, что наши графы связны и содержат хотя бы 3 вершины.
    \end{remark}
    \begin{theorem}[Теорема Дирака]
        Пусть $G$~--- связный граф с хотя бы 3 вершинами. Если степень любой его вершины $\geqslant\frac n2$, то граф гамильтонов.
    \end{theorem}
    \begin{theorem}[Теорема Оре]
        Пусть $G$~--- связный граф с хотя бы 3 вершинами. Если для любых двух его несмежных вершин $u,v~\deg u+\deg v\geqslant n$, то граф гамильтонов.
    \end{theorem}
    \begin{theorem}[Теорема Хватала]
        Пусть $G$~--- связный граф с хотя бы 3 вершинами. Пусть его степени вершин~--- $d_1\leqslant d_2\leqslant\cdots\leqslant d_n$. Если выполнено условие
        $$
        d_k\leqslant k<\frac n2\rightarrow d_{n-k}\geqslant n-k
        $$
        то $G$~--- гамильтонов.
    \end{theorem}
    \begin{proof}
        Для начала условие
        $$
        d_k\leqslant k<\frac n2\rightarrow d_{n-k}\geqslant n-k
        $$
        назовём $(*)$.\\
        Итак, пусть $G$~--- негамильтонов граф, в котором $(*)$.
        \begin{lemma}
            Пусть $G$ выполнено $(*)$, $uv\notin E$. Тогда $G\cup\{uv\}$ также $(*)$.
        \end{lemma}
        \begin{proof}
            Пусть мы имели
            $$d_1\leqslant d_2\leqslant\cdots\leqslant d_n$$
            Мы увеличили на 1 $d_u$ и $d_v$. После пересортировки они переедут после всех вершин, которые имели степень ровно $d_u$/$d_v$ соотвественно. Давайте заметим, что $d_i\leqslant d'_i$, если трактовать $i$ как номера. Ну, и хорошо, от этого условия мы как раз и понимаем, что $(*)$.
        \end{proof}
        Из всех графов, для которых не выполняется теорема Хватала, рассмотрим граф, у которого наименьшее количество вершин, а из всех таких граф с наибольшим количеством рёбер. Во-первых, это не полный граф, иначе граф гамильтонов. Тогда возьмём ребро, которого в графе нет. Пусть это ребро $uv$. Очевидно, $G\cup\{uv\}$ гамильтонов (мы брали максимальное количество рёбер). Давайте тогда выберем не просто $u,v$, а такие, что $\deg u+\deg v$ максимально. Итак, $G\cup\{uv\}$ гамильтонов, а значит $G$~--- полугамильтонов. Давайте тогда вдоль пути пронумеруем вершины: $u=u_1\to u_2\to\cdots\to u_{n-1}\to u_n=v$.\\
        Введём множество $S=\{i\in[1:n]\mid uu_i\in E\}$. Понятно, что $S\subset\{2,3,\ldots,n-1\}$. Введём множество $T=\{i\in[1:n]\mid u_{i-1}v\in E\}\subset\{3,4,\ldots,n\}$. Понятно, $|S|=\deg u$, $|T|=\deg v$. Менее понятно, $S\cap T=\varnothing$. Почему так? Если они пересекаются по $i$, то есть гамильтонов цикл
        $$u\to u_2\to u_3\to\cdots\to u_{i-1}\to v\to u_{n-1}\to u_{n-2}\to\cdots\to u_i\to u$$
        Отсюда $\deg u+\deg v\leqslant n-1$.\\
        Не умаляя общности давайте считать, что $\deg u\leqslant\deg v$. Тогда $\deg u=k<\frac n2$. Рассмотрим множество вершин $\{u_{i-1}\mid i\in S\}$. По условию $S\cap T=\varnothing$, для каждой $u_{i-1}v\notin E$. Заметим, что степень каждой вершины $\deg u_{i-1}\leqslant k$. А значит, у нас существует хотя бы $k$ вершин степени $\leqslant k$. Отсюда $d_k\leqslant k<\frac n2$. По $(*)$ отсюда следует, что $d_{n-k}\geqslant n-k$. То есть существует хотя бы $k+1$ вершина степени $\geqslant n-k$ (с номерами от $n-k$ до $n$ включительно). А отсюда $\exists w~uw\notin E\land\deg w\geqslant n-k$. А тогда $\deg u+\deg w\geqslant n$~--- противоречие с выбором $v$.
    \end{proof}
    \begin{theorem}[Обратная к теореме Хватала]
        Если $n\geqslant 3$ и $d_1\leqslant d_2\leqslant\cdots\leqslant d_n$~--- последовательность, для которой не выполнено $(*)$, то существует негамильтонов граф, для которого $d_1,\ldots d_n$ являются степенной последовательностью.\\
        Доказательство данной теоремы оставляется читателю.
    \end{theorem}
    \begin{theorem}[Теорема Гуйа~--- Ури]
        Рассмотрим ориентированный граф. Если для любой вершины её входящая и исходящая степень больше либо равны $\frac n2$, то $G$~--- гамильтонов.\\
        Тоже оставляется читателю.
    \end{theorem}
    \begin{definition}
        Граф называется турниром, если он является ориентацией полного графа.
    \end{definition}
    \begin{theorem}[Теорема Релеи~--- Камеона]
        Любой сильно связный турнир содержит гамильтонов цикл.\\
        Также оставляется читателю.
    \end{theorem}
    \paragraph{Укладки графов. Планарность.}
    \begin{remark}
        Концептуально мы рассматриваем достаточно хорошее многообразие и пытаемся уложить на нём граф. <<Хорошее>> — не надо треугольников Серпинского, непрерывных нигде не гладких многообразий, тороидов с бесконечным числом дырок и т.п. Не очень интересно всё это формализовать, и мы не будем.
    \end{remark}
    \begin{definition}
        Пусть $X$~--- <<достаточно хорошее>> многообразие, $G$~--- граф. Тогда его \textbf{вложением} в $X$ называется отображения $p\colon V\to X$ и $q\colon E\to C_X$ (множество всех кривых в $X$), при этом никакие две кривые, соответствующие рёбрам, не пересекаются кроме как в вершине, и две кривые пересекаются в вершине только тогда,
        когда они оба инцидентны этой вершине.
    \end{definition}
    \begin{theorem}
        Любой граф вкладываем в $\mathbb R^3$.
    \end{theorem}
    \begin{proof}
        Давайте возьмём случайное расположение вершин и соединим их прямыми. Вероятность пересечения~--- ноль (как минимум потому, что нам необходимо, чтобы 4 точки лежали в одной плоскости, а у этого нулевая вероятность).
    \end{proof}
    \begin{proof}
        Давайте расположим вершины по окружности, для каждой вершины $u$ выделим
        $\deg u$ прямых (близких к вертикальной), и если у нас не получается провести ребро в плоскости, на разную высоту будем подниматься (вдоль правильной прямой), и там проводим ребро.
    \end{proof}
    \begin{claim}
        Любая замкнутая кривая без самопересечений и самокасаний делит плоскость на две части: конечную и бесконечную.
    \end{claim}
    \begin{definition}
        У условиях предыдущего утверждения конечную часть будем называть \textbf{внутренней}, бесконечную~--- \textbf{внешней}.
    \end{definition}
    \begin{claim}
        При наличии замкнутой кривой без самопересечений и самокасаний любые две точки в одной части разбиения можно соединить <<достаточно хорошей кривой>>.
    \end{claim}
    \begin{definition}
        Граф, вложимый в $\mathbb R^2$, называется \textbf{планарным}.
    \end{definition}
    \begin{definition}
        Укладка планарного графа называется \textbf{плоским графом}.
    \end{definition}
    \begin{definition}
        Плоский граф разбивает плоскости на какие-то связные области. Эти области называются \textbf{гранями}.
    \end{definition}
    \begin{theorem}[Формула Эйлера]
        Пусть в связном планарном графе $V$ вершин и $E$ рёбер, а при его
        укладке на плоскости получилось $F$ граней. Тогда
        $$V+F-E=2$$
    \end{theorem}
    \begin{proof}
        Докажем индукцией по количеству вершин и рёбер. Если у нас 1 вершина и 0 рёбер,
        то грань там тоже одна.\\
        Пусть у нас не 1 вершина. Если наш граф дерево, у него $n$ вершин, $n-1$ ребро и 1 грань. Если наш
        граф не дерево, у нас есть хоть один не-мост. Тогда он лежит в цикле, а значит при удалении этого
        ребра у нас уменьшится количество граней на 1. При этом граф останется связным. Из индукционного
        предположения $V+(F-1)-(E-1)=2$, всё.
    \end{proof}
    \begin{corollary}
        Если планарный граф имеет $k$ компонент связности, $V$ вершин, $E$ рёбер, а при его
        укладке получилось $F$ граней, то
        $$F+V-E=k+1$$
    \end{corollary}
    \begin{lemma}
        Граф $K_5$ не планарен.
    \end{lemma}
    \begin{proof}
        Пусть он планарен. Тогда для любой его укладки верна формула Эйлера. То есть уложив его на плоскости, получим $F=7$. Посмотрим на эти грани. Каждая окружается каким-то циклом, а цикл содержит хотя бы 3 ребра. То есть сумма длин циклов вокруг граней больше либо равна 21. С другой стороны, каждое ребро входит в 2 цикла. А значит у нас $\geqslant10.5$ рёбер. Ой.
    \end{proof}
    \begin{claim}
        В планарном графе $E\leqslant3V-6$.
    \end{claim}
    \begin{proof}
        В доказательстве предыдущей теоремы мы выяснили, что $F=2-V+E$ и $2E\geqslant 2F$. Отсюда следует то, что мы хотели доказать.
    \end{proof}
    \begin{lemma}
        $K_{3,3}$ не планарен.
    \end{lemma}
    \begin{proof}
        Пусть он планарен. Тогда, для него верна формула Эйлера. То есть уложив его на плоскости, получим $F=5$. Посмотрим на эти грани. Каждая окружается каким-то циклом, а \underline{цикл содержит хотя бы 4 ребра, потому что граф двудолен}. То есть сумма длин циклов вокруг граней больше либо равна 20. С другой стороны, каждое ребро входит в 2 цикла. А значит у нас $\geqslant10$ рёбер. Ой.
    \end{proof}
    \begin{remark}
        Оказывается, каждый не планарный граф содержит внутри себя $K_5$ или $K_{3,3}$. Но содержит весьма специфичным образом. Сейчас опишем, каким.
    \end{remark}
    \begin{definition}
        Граф $G_1$ \textbf{гомеоморфен} графу $G_2$, если $\exists G_3$ изоморфный $G_1$ такой что его можно получить из $G_2$ конечным количеством следующих операций: убрать вершину степени 2 и соединить её соседей либо, наоборот, убрать ребро и заменить его вершиной степени 2, соединённой с концами удалённого ребра.
    \end{definition}
    \begin{remark}
        Гомеоморфность, на самом деле,~--- эквивалентность топологический пространств. Как это вообще с графами связано? А вот как:\\
        Граф можно сделать топологическим пространством. У нас вершины будут точками, а
        рёбра~--- бесконечно тонкими нитками. И тогда у вершины будет окрестность из маленьких кусочков инцидентных её рёбер, а ещё будут окрестности на ребре. Вот это всё чудо является базой топологии на графах. При этом, очевидно, у нас ничего не меняется в окрестностях, если мы добавляем либо убираем вершину степени 2, а значит в качестве гомеоморфности на графах мы имеем именно то определение, что написано выше.
    \end{remark}
    \begin{property}
        Гомеоморфные графы либо одновременно планарны, либо одновременно нет.
    \end{property}
    \begin{proof}
        Тривиально.
    \end{proof}
    \begin{lemma}
        Дерево планарно.
    \end{lemma}
    \begin{proof}
        Подвесим дерево. Теперь сопоставим каждой вершине отрезок вот так: корню соответствует $[0; 1]$, для детей берём их родителя и делим его отрезок на столько частей, сколько детей. После этого расположим вершины одного уровня на одной вертикали, а по горизонтали в их отрезок. Нетрудно заметить, что получится плоский граф.
    \end{proof}
    \begin{lemma}
        Граф планарен тогда и только тогда, когда его можно уложить на сфере.
    \end{lemma}
    \begin{proof}
        Для начала предъявим гомеоморфизм сферы без точки и плоскости. Возьмём сферу, положим южным полюсом на плоскости, и будем проводит прямые через северный полюс. Они соединяют ещё одну точку сферы с точкой плоскости, вот это и нужное нам отображение. Тривиально, оно непрерывно и биективно (и обратное к нему непрерывно).\\
        Тогда по этой биекции располагаем граф, и получаем то, что мы хотим.
    \end{proof}
    \begin{lemma}
        Для любой вершины $u$ существует укладка $G$ на плоскости, что $u$~--- вершина внешней грани.
    \end{lemma}
    \begin{proof}
        Уложим граф на сферу, возьмём сферу в руки и повернём сферу так, чтобы верхняя грань содержала $u$. Разложим обратно из сферы на плоскости.
    \end{proof}
    \begin{lemma}
        Для любого ребра $uv$ существует укладка $G$ на плоскости, что $uv$~--- ребро внешней грани.
    \end{lemma}
    \begin{proof}
        Аналогично предыдущему.
    \end{proof}
    \begin{lemma}
        \label{lmm:Граф планарен тогда и только тогда, когда все его компоненты рёберной двусвязности планарны.}
        Граф планарен тогда и только тогда, когда все его компоненты рёберной двусвязности планарны.
    \end{lemma}
    \begin{proof}
        В одну сторону очевидно, в другую раскладываем по индукции по количеству компонент.\\
        Если компонент одна, понятно, если несколько, уберём ту, которая в дереве мостов~--- лист. По индукции расположим остаток так, чтобы вершина, к которой соединён мост, оказалась на внешней грани. Соединим с удалённой компонентой рёберной двусвязности.
    \end{proof}
    \begin{lemma}
        \label{lmm:Граф планарен тогда и только тогда, когда все его компоненты вершинной двусвязности планарны.}
        Граф планарен тогда и только тогда, когда все его компоненты вершинной двусвязности планарны.
    \end{lemma}
    \begin{proof}
        Доказательство. Опять же, в одну сторону очевидно, в другую по индукции. База~--- очевидно, переход~--- аналогично.
    \end{proof}
    \begin{theorem}[Теорема Понтрягина~--- Куратовского]
        Граф планарен тогда и только тогда, когда у него не существует подграфа, гомеоморфного $K_5$ или $K_{3,3}$.
    \end{theorem}
    \begin{proof}
        Влево очевидно, а вправо придётся страдать.\\
        Нам надо доказать, что граф без $K_5$ и $K_{3,3}$ планарен. Пусть это не так. Тогда давайте из всех таких графов рассмотрим граф $G$, у которого минимальное количество вершин. Если таких несколько, возьмём с минимальным количеством рёбер. Тогда пусть $uv$~--- ребро. При его удалении $K_5$ или $K_{3,3}$ не появится, а рёбер станет меньше, значит $G\setminus uv$ планарен.
        \begin{lemma}
            $G\setminus uv$ не содержит мостов и точек сочленения.
        \end{lemma}
        \begin{proof}
            Заметим, что по минимальности $G$ и леммам \ref{lmm:Граф планарен тогда и только тогда, когда все его компоненты рёберной двусвязности планарны.} и \ref{lmm:Граф планарен тогда и только тогда, когда все его компоненты вершинной двусвязности планарны.} сам $G$ не содержит мостов и точек сочленения. А значит, если $G\setminus uv$ содержит, то $u$ и $v$ лежат в разных компонентах двусвязности. Пусть $G\setminus uv$ содержит мост $ab$.
            \begin{figure}[H]
                \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                    %Shape: Ellipse [id:dp9619429247773177] 
                    \draw   (111.8,128.5) .. controls (111.8,77.41) and (132.39,36) .. (157.8,36) .. controls (183.21,36) and (203.8,77.41) .. (203.8,128.5) .. controls (203.8,179.59) and (183.21,221) .. (157.8,221) .. controls (132.39,221) and (111.8,179.59) .. (111.8,128.5) -- cycle ;
                    %Shape: Ellipse [id:dp1600598469749579] 
                    \draw   (406.8,134.5) .. controls (406.8,83.41) and (427.39,42) .. (452.8,42) .. controls (478.21,42) and (498.8,83.41) .. (498.8,134.5) .. controls (498.8,185.59) and (478.21,227) .. (452.8,227) .. controls (427.39,227) and (406.8,185.59) .. (406.8,134.5) -- cycle ;
                    %Shape: Circle [id:dp4680554308214795] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (171,90.4) .. controls (171,87.42) and (173.42,85) .. (176.4,85) .. controls (179.38,85) and (181.8,87.42) .. (181.8,90.4) .. controls (181.8,93.38) and (179.38,95.8) .. (176.4,95.8) .. controls (173.42,95.8) and (171,93.38) .. (171,90.4) -- cycle ;
                    %Shape: Circle [id:dp3544158038838776] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (158.5,172.4) .. controls (158.5,169.42) and (160.92,167) .. (163.9,167) .. controls (166.88,167) and (169.3,169.42) .. (169.3,172.4) .. controls (169.3,175.38) and (166.88,177.8) .. (163.9,177.8) .. controls (160.92,177.8) and (158.5,175.38) .. (158.5,172.4) -- cycle ;
                    %Shape: Circle [id:dp5929980589363897] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (439.5,101.9) .. controls (439.5,98.92) and (441.92,96.5) .. (444.9,96.5) .. controls (447.88,96.5) and (450.3,98.92) .. (450.3,101.9) .. controls (450.3,104.88) and (447.88,107.3) .. (444.9,107.3) .. controls (441.92,107.3) and (439.5,104.88) .. (439.5,101.9) -- cycle ;
                    %Shape: Circle [id:dp694420722485745] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (451,185.4) .. controls (451,182.42) and (453.42,180) .. (456.4,180) .. controls (459.38,180) and (461.8,182.42) .. (461.8,185.4) .. controls (461.8,188.38) and (459.38,190.8) .. (456.4,190.8) .. controls (453.42,190.8) and (451,188.38) .. (451,185.4) -- cycle ;
                    %Straight Lines [id:da48039706041655617] 
                    \draw    (163.9,172.4) -- (456.4,185.4) ;
                    %Straight Lines [id:da3097592848427295] 
                    \draw    (176.4,90.4) -- (444.9,101.9) ;

                    % Text Node
                    \draw (164.86,68.9) node [anchor=north west][inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (450.86,80.4) node [anchor=north west][inner sep=0.75pt]    {$b$};
                    % Text Node
                    \draw (148.86,150.4) node [anchor=north west][inner sep=0.75pt]    {$u$};
                    % Text Node
                    \draw (462.36,165.4) node [anchor=north west][inner sep=0.75pt]    {$v$};
                \end{tikzpicture}
            \end{figure}\noindent
            Тогда сделаем вот такое преобразование:
            \begin{figure}[H]
                \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                    %Shape: Ellipse [id:dp9619429247773177] 
                    \draw   (111.8,128.5) .. controls (111.8,77.41) and (132.39,36) .. (157.8,36) .. controls (183.21,36) and (203.8,77.41) .. (203.8,128.5) .. controls (203.8,179.59) and (183.21,221) .. (157.8,221) .. controls (132.39,221) and (111.8,179.59) .. (111.8,128.5) -- cycle ;
                    %Shape: Ellipse [id:dp1600598469749579] 
                    \draw   (406.8,134.5) .. controls (406.8,83.41) and (427.39,42) .. (452.8,42) .. controls (478.21,42) and (498.8,83.41) .. (498.8,134.5) .. controls (498.8,185.59) and (478.21,227) .. (452.8,227) .. controls (427.39,227) and (406.8,185.59) .. (406.8,134.5) -- cycle ;
                    %Shape: Circle [id:dp4680554308214795] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (171,90.4) .. controls (171,87.42) and (173.42,85) .. (176.4,85) .. controls (179.38,85) and (181.8,87.42) .. (181.8,90.4) .. controls (181.8,93.38) and (179.38,95.8) .. (176.4,95.8) .. controls (173.42,95.8) and (171,93.38) .. (171,90.4) -- cycle ;
                    %Shape: Circle [id:dp3544158038838776] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (158.5,172.4) .. controls (158.5,169.42) and (160.92,167) .. (163.9,167) .. controls (166.88,167) and (169.3,169.42) .. (169.3,172.4) .. controls (169.3,175.38) and (166.88,177.8) .. (163.9,177.8) .. controls (160.92,177.8) and (158.5,175.38) .. (158.5,172.4) -- cycle ;
                    %Shape: Circle [id:dp5929980589363897] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (439.5,101.9) .. controls (439.5,98.92) and (441.92,96.5) .. (444.9,96.5) .. controls (447.88,96.5) and (450.3,98.92) .. (450.3,101.9) .. controls (450.3,104.88) and (447.88,107.3) .. (444.9,107.3) .. controls (441.92,107.3) and (439.5,104.88) .. (439.5,101.9) -- cycle ;
                    %Shape: Circle [id:dp694420722485745] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (451,185.4) .. controls (451,182.42) and (453.42,180) .. (456.4,180) .. controls (459.38,180) and (461.8,182.42) .. (461.8,185.4) .. controls (461.8,188.38) and (459.38,190.8) .. (456.4,190.8) .. controls (453.42,190.8) and (451,188.38) .. (451,185.4) -- cycle ;
                    %Curve Lines [id:da07799184864792963] 
                    \draw    (176.4,90.4) .. controls (290.55,71) and (317.55,205) .. (163.9,172.4) ;

                    % Text Node
                    \draw (164.86,68.9) node [anchor=north west][inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (450.86,80.4) node [anchor=north west][inner sep=0.75pt]    {$b$};
                    % Text Node
                    \draw (148.86,150.4) node [anchor=north west][inner sep=0.75pt]    {$u$};
                    % Text Node
                    \draw (462.36,165.4) node [anchor=north west][inner sep=0.75pt]    {$v$};
                \end{tikzpicture}
            \end{figure}\noindent
            Утверждается, что каждая из компонент связности (например, левая) не содержит $K_5$ и $K_{3,3}$. Почему? Ну, пусть содержит. Тогда $au$~--- ребро такого подграфа. А давайте вместо него возьмём $u\to v\leadsto b\to a$ в исходном графе и сожмём в одно ребро (по определению гомеоморфности мы так можем). Получим, что исходный граф тоже содержал $K_5$ или $K_{3,3}$. Поскольку в левой компоненте связности меньше рёбер, чем в $G$, она планарна. А значит её можно уложить так, чтобы $au$ было на внешней грани. То же самое сделаем с правой компонентой связности
            \begin{figure}[H]
                \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                    %Shape: Circle [id:dp4680554308214795] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (236,95.4) .. controls (236,92.42) and (238.42,90) .. (241.4,90) .. controls (244.38,90) and (246.8,92.42) .. (246.8,95.4) .. controls (246.8,98.38) and (244.38,100.8) .. (241.4,100.8) .. controls (238.42,100.8) and (236,98.38) .. (236,95.4) -- cycle ;
                    %Shape: Circle [id:dp3544158038838776] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (208.5,190.4) .. controls (208.5,187.42) and (210.92,185) .. (213.9,185) .. controls (216.88,185) and (219.3,187.42) .. (219.3,190.4) .. controls (219.3,193.38) and (216.88,195.8) .. (213.9,195.8) .. controls (210.92,195.8) and (208.5,193.38) .. (208.5,190.4) -- cycle ;
                    %Shape: Circle [id:dp5929980589363897] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (342.5,103.9) .. controls (342.5,100.92) and (344.92,98.5) .. (347.9,98.5) .. controls (350.88,98.5) and (353.3,100.92) .. (353.3,103.9) .. controls (353.3,106.88) and (350.88,109.3) .. (347.9,109.3) .. controls (344.92,109.3) and (342.5,106.88) .. (342.5,103.9) -- cycle ;
                    %Shape: Circle [id:dp694420722485745] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (354,187.4) .. controls (354,184.42) and (356.42,182) .. (359.4,182) .. controls (362.38,182) and (364.8,184.42) .. (364.8,187.4) .. controls (364.8,190.38) and (362.38,192.8) .. (359.4,192.8) .. controls (356.42,192.8) and (354,190.38) .. (354,187.4) -- cycle ;
                    %Curve Lines [id:da5418433075198561] 
                    \draw    (213.9,190.4) .. controls (85.55,220) and (125.55,1) .. (241.4,95.4) ;
                    %Straight Lines [id:da4600459397491037] 
                    \draw    (241.4,95.4) -- (213.9,190.4) ;
                    %Straight Lines [id:da3893539151760381] 
                    \draw    (347.9,103.9) -- (359.4,187.4) ;
                    %Curve Lines [id:da5543315017764847] 
                    \draw    (359.4,187.4) .. controls (469.55,279) and (521.55,-5) .. (347.9,103.9) ;

                    % Text Node
                    \draw (243.4,92) node [anchor=south west] [inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (345.9,100.5) node [anchor=south east] [inner sep=0.75pt]    {$b$};
                    % Text Node
                    \draw (211.9,187) node [anchor=south east] [inner sep=0.75pt]    {$u$};
                    % Text Node
                    \draw (357.4,184) node [anchor=south east] [inner sep=0.75pt]    {$v$};
                \end{tikzpicture}
            \end{figure}\noindent
            А после этого мы можем удалить обратно добавленные рёбра $au$ и $bv$, но добавить два удалённых ребра $ab$ и $uv$, получив, что исходный граф был планарен, тем самым получив противоречие с наличием моста в $G\setminus uv$.\\
            Доказательство отсутствия точек сочленения аналогично.
        \end{proof}
        Отсюда получается, что $uv$ лежат на цикле в графе $G\setminus uv$. Почему? Потому что возьмём два любых ребра, инцидентных $u$ и $v$ соотвественно, по лемме эти рёбра вершинно двусвязны, а значит лежат на цикле.\\
        Давайте среди всех циклов, на которых лежат $uv$ и для всех укладок графа $G\setminus uv$ на плоскости возьмём тот цикл $C$ и ту укладку, что внутри $C$ находится максимальное количество граней. Несмотря на то, что укладок у нас бесконечно много, взять максимум мы можем, потому что граней у нас в принципе конечное число, а значит укладки разбиваются на классы эквивалентности по количеству граней внутри $C$.\\
        Давайте удалим наш цикл. Что останется от графа? Какие-то компоненты связности. Очевидно, каждая компонента лежит либо полностью внутри цикла, либо полностью вне (иначе рёбра пересекаются). Как они лежат в графе? Ну, как-то так:
        \begin{figure}[H]
            \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                %Straight Lines [id:da09816083328065961] 
                \draw    (357.8,88.2) -- (461.64,94.6) ;
                %Straight Lines [id:da6576223354128274] 
                \draw    (456.84,123) -- (361.4,171.4) ;
                %Straight Lines [id:da3246672730852964] 
                \draw    (329.6,49) -- (291.24,115.16) ;
                %Straight Lines [id:da3647321560487098] 
                \draw    (361.4,171.4) -- (291.24,157.56) ;
                %Straight Lines [id:da21362559206306475] 
                \draw    (149.6,179.4) -- (221.64,141.96) ;
                %Shape: Circle [id:dp9084690040636754] 
                \draw   (140,133.77) .. controls (140,70.94) and (190.94,20) .. (253.77,20) .. controls (316.61,20) and (367.55,70.94) .. (367.55,133.77) .. controls (367.55,196.61) and (316.61,247.55) .. (253.77,247.55) .. controls (190.94,247.55) and (140,196.61) .. (140,133.77) -- cycle ;
                %Shape: Circle [id:dp5901768406782604] 
                \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (177.2,45) .. controls (177.2,42.02) and (179.62,39.6) .. (182.6,39.6) .. controls (185.58,39.6) and (188,42.02) .. (188,45) .. controls (188,47.98) and (185.58,50.4) .. (182.6,50.4) .. controls (179.62,50.4) and (177.2,47.98) .. (177.2,45) -- cycle ;
                %Shape: Circle [id:dp050894915611129576] 
                \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (180,223.8) .. controls (180,220.82) and (182.42,218.4) .. (185.4,218.4) .. controls (188.38,218.4) and (190.8,220.82) .. (190.8,223.8) .. controls (190.8,226.78) and (188.38,229.2) .. (185.4,229.2) .. controls (182.42,229.2) and (180,226.78) .. (180,223.8) -- cycle ;
                %Shape: Ellipse [id:dp6351442582714808] 
                \draw   (221,136.5) .. controls (221,120.76) and (239.76,108) .. (262.9,108) .. controls (286.04,108) and (304.8,120.76) .. (304.8,136.5) .. controls (304.8,152.24) and (286.04,165) .. (262.9,165) .. controls (239.76,165) and (221,152.24) .. (221,136.5) -- cycle ;
                %Shape: Circle [id:dp06668840166642509] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (324.2,49) .. controls (324.2,46.02) and (326.62,43.6) .. (329.6,43.6) .. controls (332.58,43.6) and (335,46.02) .. (335,49) .. controls (335,51.98) and (332.58,54.4) .. (329.6,54.4) .. controls (326.62,54.4) and (324.2,51.98) .. (324.2,49) -- cycle ;
                %Shape: Circle [id:dp08762646360449144] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (356,171.4) .. controls (356,168.42) and (358.42,166) .. (361.4,166) .. controls (364.38,166) and (366.8,168.42) .. (366.8,171.4) .. controls (366.8,174.38) and (364.38,176.8) .. (361.4,176.8) .. controls (358.42,176.8) and (356,174.38) .. (356,171.4) -- cycle ;
                %Shape: Circle [id:dp9887746533272483] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (144.2,179.4) .. controls (144.2,176.42) and (146.62,174) .. (149.6,174) .. controls (152.58,174) and (155,176.42) .. (155,179.4) .. controls (155,182.38) and (152.58,184.8) .. (149.6,184.8) .. controls (146.62,184.8) and (144.2,182.38) .. (144.2,179.4) -- cycle ;
                %Shape: Circle [id:dp8391128746432603] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (352.4,88.2) .. controls (352.4,85.22) and (354.82,82.8) .. (357.8,82.8) .. controls (360.78,82.8) and (363.2,85.22) .. (363.2,88.2) .. controls (363.2,91.18) and (360.78,93.6) .. (357.8,93.6) .. controls (354.82,93.6) and (352.4,91.18) .. (352.4,88.2) -- cycle ;
                %Shape: Ellipse [id:dp16105115201202969] 
                \draw   (457,117.1) .. controls (457,92.41) and (473.53,72.4) .. (493.92,72.4) .. controls (514.31,72.4) and (530.84,92.41) .. (530.84,117.1) .. controls (530.84,141.79) and (514.31,161.8) .. (493.92,161.8) .. controls (473.53,161.8) and (457,141.79) .. (457,117.1) -- cycle ;

                % Text Node
                \draw (183.4,227.2) node [anchor=north east] [inner sep=0.75pt]    {$v$};
                % Text Node
                \draw (180.6,41.6) node [anchor=south east] [inner sep=0.75pt]    {$u$};
                % Text Node
                \draw (262.9,136.5) node    {$\mathrm{In}$};
                % Text Node
                \draw (493.92,117.1) node    {$\mathrm{Out}$};
            \end{tikzpicture}
        \end{figure}\noindent
        Если у нас вершины цикла соединены между собой напрямую, будем считать, что между ними просто внешняя или внутренняя компонента из 0 вершин. Или можно вставить туда вершину степени 2 (у нас же всё работает с точностью до гомеоморфзма). При этом и внешних, и внутренних компонент есть хотя бы одна, иначе $G$ планарен (мы можем соединить $u$ и $v$ либо снаружи, либо внутри ребром).\\
        Заметим, что у нас цикл $C$ мы можем разделить на 2 участка, на 2 пути от $u$ до $v$. На картинке есть левая часть цикла и правая. Так вот,
        \begin{lemma}
            Каждая внешняя компонента подсоединяется к циклу ровно в двух точках. Причём эти две точки лежат на разных частях цикла.
        \end{lemma}
        \begin{proof}
            В одной не может быть, потому что это точка сочленения. Если не в одной и либо не в двух, либо в двух, но с одной стороны, то две вершины с одной стороны точно есть, а значит в качестве цикла $C$ мы могли взять вот такой, у которого внутри больше граней.
            \begin{figure}[H]
                \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                    %Shape: Arc [id:dp35477129704802923] 
                    \draw  [draw opacity=0] (361.24,171.22) .. controls (345.76,215.66) and (303.49,247.55) .. (253.77,247.55) .. controls (190.94,247.55) and (140,196.61) .. (140,133.77) .. controls (140,70.94) and (190.94,20) .. (253.77,20) .. controls (300.86,20) and (341.27,48.61) .. (358.57,89.4) -- (253.77,133.77) -- cycle ; \draw  [color={rgb, 255:red, 0; green, 49; blue, 255 }  ,draw opacity=1 ] (361.24,171.22) .. controls (345.76,215.66) and (303.49,247.55) .. (253.77,247.55) .. controls (190.94,247.55) and (140,196.61) .. (140,133.77) .. controls (140,70.94) and (190.94,20) .. (253.77,20) .. controls (300.86,20) and (341.27,48.61) .. (358.57,89.4) ;  
                    %Straight Lines [id:da09816083328065961] 
                    \draw [color={rgb, 255:red, 0; green, 49; blue, 255 }  ,draw opacity=1 ]   (357.8,88.2) -- (461.64,94.6) ;
                    %Straight Lines [id:da6576223354128274] 
                    \draw [color={rgb, 255:red, 0; green, 49; blue, 255 }  ,draw opacity=1 ]   (456.84,123) -- (361.4,171.4) ;
                    %Shape: Arc [id:dp13748444086462186] 
                    \draw  [draw opacity=0] (357.78,87.58) .. controls (364.06,101.69) and (367.55,117.33) .. (367.55,133.77) .. controls (367.55,146.95) and (365.3,159.61) .. (361.18,171.39) -- (253.77,133.77) -- cycle ; \draw   (357.78,87.58) .. controls (364.06,101.69) and (367.55,117.33) .. (367.55,133.77) .. controls (367.55,146.95) and (365.3,159.61) .. (361.18,171.39) ;  
                    %Shape: Circle [id:dp5901768406782604] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (177.2,45) .. controls (177.2,42.02) and (179.62,39.6) .. (182.6,39.6) .. controls (185.58,39.6) and (188,42.02) .. (188,45) .. controls (188,47.98) and (185.58,50.4) .. (182.6,50.4) .. controls (179.62,50.4) and (177.2,47.98) .. (177.2,45) -- cycle ;
                    %Shape: Circle [id:dp050894915611129576] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (180,223.8) .. controls (180,220.82) and (182.42,218.4) .. (185.4,218.4) .. controls (188.38,218.4) and (190.8,220.82) .. (190.8,223.8) .. controls (190.8,226.78) and (188.38,229.2) .. (185.4,229.2) .. controls (182.42,229.2) and (180,226.78) .. (180,223.8) -- cycle ;
                    %Shape: Circle [id:dp08762646360449144] 
                    \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (356,171.4) .. controls (356,168.42) and (358.42,166) .. (361.4,166) .. controls (364.38,166) and (366.8,168.42) .. (366.8,171.4) .. controls (366.8,174.38) and (364.38,176.8) .. (361.4,176.8) .. controls (358.42,176.8) and (356,174.38) .. (356,171.4) -- cycle ;
                    %Shape: Circle [id:dp8391128746432603] 
                    \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (352.4,88.2) .. controls (352.4,85.22) and (354.82,82.8) .. (357.8,82.8) .. controls (360.78,82.8) and (363.2,85.22) .. (363.2,88.2) .. controls (363.2,91.18) and (360.78,93.6) .. (357.8,93.6) .. controls (354.82,93.6) and (352.4,91.18) .. (352.4,88.2) -- cycle ;
                    %Shape: Ellipse [id:dp16105115201202969] 
                    \draw   (457,117.1) .. controls (457,92.41) and (473.53,72.4) .. (493.92,72.4) .. controls (514.31,72.4) and (530.84,92.41) .. (530.84,117.1) .. controls (530.84,141.79) and (514.31,161.8) .. (493.92,161.8) .. controls (473.53,161.8) and (457,141.79) .. (457,117.1) -- cycle ;
                    %Curve Lines [id:da944860984134889] 
                    \draw [color={rgb, 255:red, 0; green, 49; blue, 255 }  ,draw opacity=1 ]   (456.84,123) .. controls (465.8,130) and (506.8,80) .. (461.64,94.6) ;

                    % Text Node
                    \draw (183.4,227.2) node [anchor=north east] [inner sep=0.75pt]    {$v$};
                    % Text Node
                    \draw (180.6,41.6) node [anchor=south east] [inner sep=0.75pt]    {$u$};
                    % Text Node
                    \draw (493.92,117.1) node    {$\mathrm{Out}$};
                \end{tikzpicture}
            \end{figure}\noindent
        \end{proof}
        А отсюда следует, что на внутренних компонентах есть естественный порядок. Если есть две компоненты, то у одной обе точки присоединения ближе к $u$, а у другой~--- ближе к $v$.\\
        А что мы можем сказать про внутренние компоненты? Ну, с ними уже всё не так понятно. Но введём пару определений
        \begin{definition}
            Будем говорить, что внутренняя часть $\mathrm{In}$ разделяет $u$ и $v$, если у неё существуют две точки подключения по разные стороны цикла $C$.
        \end{definition}
        \begin{definition}
            Будем говорить, что внутренняя часть $\mathrm{In}$ разделяет внешнюю часть $\mathrm{Out}$, если у неё существуют две точки подключения, которые находятся по разные стороны цикла $C$, где стороны берутся относительно точек подключения $\mathrm{Out}$ (см. картинку).
        \end{definition}
        \begin{example}
            \begin{figure}[H]
                \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                    %Shape: Arc [id:dp24254826825833287] 
                    \draw  [draw opacity=0] (358.11,88.34) .. controls (364.18,102.26) and (367.55,117.62) .. (367.55,133.77) .. controls (367.55,170.41) and (350.23,203) .. (323.34,223.81) -- (253.77,133.77) -- cycle ; \draw  [color={rgb, 255:red, 255; green, 0; blue, 0 }  ,draw opacity=1 ] (358.11,88.34) .. controls (364.18,102.26) and (367.55,117.62) .. (367.55,133.77) .. controls (367.55,170.41) and (350.23,203) .. (323.34,223.81) ;  
                    %Shape: Arc [id:dp7438062927546976] 
                    \draw  [draw opacity=0] (321.5,225.2) .. controls (302.58,239.24) and (279.14,247.55) .. (253.77,247.55) .. controls (190.94,247.55) and (140,196.61) .. (140,133.77) .. controls (140,70.94) and (190.94,20) .. (253.77,20) .. controls (300.19,20) and (340.11,47.8) .. (357.81,87.65) -- (253.77,133.77) -- cycle ; \draw  [color={rgb, 255:red, 0; green, 0; blue, 255 }  ,draw opacity=1 ] (321.5,225.2) .. controls (302.58,239.24) and (279.14,247.55) .. (253.77,247.55) .. controls (190.94,247.55) and (140,196.61) .. (140,133.77) .. controls (140,70.94) and (190.94,20) .. (253.77,20) .. controls (300.19,20) and (340.11,47.8) .. (357.81,87.65) ;  
                    %Straight Lines [id:da48616162308916566] 
                    \draw    (321.4,225.26) -- (463.06,142.66) ;
                    %Straight Lines [id:da09816083328065961] 
                    \draw    (357.8,88.2) -- (461.64,94.6) ;
                    %Straight Lines [id:da3246672730852964] 
                    \draw    (329.6,49) -- (291.24,115.16) ;
                    %Straight Lines [id:da3647321560487098] 
                    \draw    (361.4,171.4) -- (291.24,157.56) ;
                    %Straight Lines [id:da21362559206306475] 
                    \draw    (149.6,179.4) -- (221.64,141.96) ;
                    %Shape: Ellipse [id:dp6351442582714808] 
                    \draw   (221,136.5) .. controls (221,120.76) and (239.76,108) .. (262.9,108) .. controls (286.04,108) and (304.8,120.76) .. (304.8,136.5) .. controls (304.8,152.24) and (286.04,165) .. (262.9,165) .. controls (239.76,165) and (221,152.24) .. (221,136.5) -- cycle ;
                    %Shape: Circle [id:dp06668840166642509] 
                    \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (324.2,49) .. controls (324.2,46.02) and (326.62,43.6) .. (329.6,43.6) .. controls (332.58,43.6) and (335,46.02) .. (335,49) .. controls (335,51.98) and (332.58,54.4) .. (329.6,54.4) .. controls (326.62,54.4) and (324.2,51.98) .. (324.2,49) -- cycle ;
                    %Shape: Circle [id:dp08762646360449144] 
                    \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (356,171.4) .. controls (356,168.42) and (358.42,166) .. (361.4,166) .. controls (364.38,166) and (366.8,168.42) .. (366.8,171.4) .. controls (366.8,174.38) and (364.38,176.8) .. (361.4,176.8) .. controls (358.42,176.8) and (356,174.38) .. (356,171.4) -- cycle ;
                    %Shape: Circle [id:dp9887746533272483] 
                    \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (144.2,179.4) .. controls (144.2,176.42) and (146.62,174) .. (149.6,174) .. controls (152.58,174) and (155,176.42) .. (155,179.4) .. controls (155,182.38) and (152.58,184.8) .. (149.6,184.8) .. controls (146.62,184.8) and (144.2,182.38) .. (144.2,179.4) -- cycle ;
                    %Shape: Circle [id:dp8391128746432603] 
                    \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (352.4,88.2) .. controls (352.4,85.22) and (354.82,82.8) .. (357.8,82.8) .. controls (360.78,82.8) and (363.2,85.22) .. (363.2,88.2) .. controls (363.2,91.18) and (360.78,93.6) .. (357.8,93.6) .. controls (354.82,93.6) and (352.4,91.18) .. (352.4,88.2) -- cycle ;
                    %Shape: Ellipse [id:dp16105115201202969] 
                    \draw   (457,117.1) .. controls (457,92.41) and (473.53,72.4) .. (493.92,72.4) .. controls (514.31,72.4) and (530.84,92.41) .. (530.84,117.1) .. controls (530.84,141.79) and (514.31,161.8) .. (493.92,161.8) .. controls (473.53,161.8) and (457,141.79) .. (457,117.1) -- cycle ;
                    %Shape: Circle [id:dp12165989427014212] 
                    \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (316,225.26) .. controls (316,222.27) and (318.42,219.86) .. (321.4,219.86) .. controls (324.38,219.86) and (326.8,222.27) .. (326.8,225.26) .. controls (326.8,228.24) and (324.38,230.66) .. (321.4,230.66) .. controls (318.42,230.66) and (316,228.24) .. (316,225.26) -- cycle ;
                    
                    % Text Node
                    \draw (262.9,136.5) node    {$\mathrm{In}$};
                    % Text Node
                    \draw (493.92,117.1) node    {$\mathrm{Out}$};
                    % Text Node
                    \draw (147.6,182.8) node [anchor=north east] [inner sep=0.75pt]    {$c$};
                    % Text Node
                    \draw (331.6,45.6) node [anchor=south west] [inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (363.4,174.8) node [anchor=north west][inner sep=0.75pt]    {$b$};
                \end{tikzpicture}
            \end{figure}\noindent
            Тут у нас $\mathrm{In}$ разделяет $\mathrm{Out}$, потому что $\mathrm{Out}$ делит $C$ на красную и синюю часть. Если были бы только рёбра в $a$ и $c$, то не разделяла бы, а так разделяет, хотя хватило бы и пары рёбер в $a$ и в $b$ или в $b$ и в $c$.
        \end{example}
        \begin{remark}
            При этом считается, что если точка соединения внутренней и внешней части одна и та же, то это не разделение. Аналогично с разделением $u$ и $v$.
        \end{remark}
        \begin{lemma}
            Существует внутренняя часть $\mathrm{In}_0$ и внешняя часть $\mathrm{Out}_0$ такие что $\mathrm{In}_0$ разделяет $u$ и $v$ и $\mathrm{Out}_0$.
        \end{lemma}
        \begin{proof}
            Пусть это не так. Тогда рассмотрим любую внутреннюю часть. Она не разделяет ни одну внешнюю, а значит её точки соединения лежат строго между какими-то точками соединения разных внешних частей, а это значит, что её можно превратить во внешнюю, вынеся наружу. После проведения такой операции у нас не останется компонент, разделяющий $u$ и $v$, а значит мы сможем провести ребро между ними. Противоречие.
        \end{proof}
        Пусть наша компонента $\mathrm{Out}_0$ подключается в точках $a$ и $b$. А у того, как подключается $\mathrm{In}_0$, есть варианты. А точнее, получается 12 случаев. Мы рассмотрим два из них, потому что нам лень рассматривать все. Первый:
        \begin{figure}[H]
            \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                %Straight Lines [id:da40674906584093495] 
                \draw    (350.73,192.73) -- (289.3,172) ;
                %Straight Lines [id:da0045665072056451095] 
                \draw    (228.7,146.65) -- (175.4,52.2) ;
                %Straight Lines [id:da05979547244610006] 
                \draw    (338.73,57.53) -- (462.7,93.15) ;
                %Straight Lines [id:da10700468280984254] 
                \draw    (325.73,222.2) -- (484.2,160.65) ;
                %Straight Lines [id:da7719164346025176] 
                \draw  [dash pattern={on 4.5pt off 4.5pt}]  (142.77,107.67) -- (367.49,133.77) ;
                %Shape: Ellipse [id:dp6351442582714808] 
                \draw   (205.5,172) .. controls (205.5,156.26) and (224.26,143.5) .. (247.4,143.5) .. controls (270.54,143.5) and (289.3,156.26) .. (289.3,172) .. controls (289.3,187.74) and (270.54,200.5) .. (247.4,200.5) .. controls (224.26,200.5) and (205.5,187.74) .. (205.5,172) -- cycle ;
                %Shape: Ellipse [id:dp16105115201202969] 
                \draw   (457,117.1) .. controls (457,92.41) and (473.53,72.4) .. (493.92,72.4) .. controls (514.31,72.4) and (530.84,92.41) .. (530.84,117.1) .. controls (530.84,141.79) and (514.31,161.8) .. (493.92,161.8) .. controls (473.53,161.8) and (457,141.79) .. (457,117.1) -- cycle ;
                %Shape: Circle [id:dp4843311991817585] 
                \draw   (140.06,133.77) .. controls (140.06,70.97) and (190.97,20.06) .. (253.77,20.06) .. controls (316.58,20.06) and (367.49,70.97) .. (367.49,133.77) .. controls (367.49,196.58) and (316.58,247.49) .. (253.77,247.49) .. controls (190.97,247.49) and (140.06,196.58) .. (140.06,133.77) -- cycle ;
                %Shape: Circle [id:dp9950697085260289] 
                \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (362.09,133.77) .. controls (362.09,130.79) and (364.5,128.37) .. (367.49,128.37) .. controls (370.47,128.37) and (372.89,130.79) .. (372.89,133.77) .. controls (372.89,136.76) and (370.47,139.17) .. (367.49,139.17) .. controls (364.5,139.17) and (362.09,136.76) .. (362.09,133.77) -- cycle ;
                %Shape: Circle [id:dp23061305390954878] 
                \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (137.37,107.67) .. controls (137.37,104.68) and (139.78,102.27) .. (142.77,102.27) .. controls (145.75,102.27) and (148.17,104.68) .. (148.17,107.67) .. controls (148.17,110.65) and (145.75,113.07) .. (142.77,113.07) .. controls (139.78,113.07) and (137.37,110.65) .. (137.37,107.67) -- cycle ;
                %Shape: Circle [id:dp6618290772718289] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (345.33,192.73) .. controls (345.33,189.75) and (347.75,187.33) .. (350.73,187.33) .. controls (353.72,187.33) and (356.13,189.75) .. (356.13,192.73) .. controls (356.13,195.72) and (353.72,198.13) .. (350.73,198.13) .. controls (347.75,198.13) and (345.33,195.72) .. (345.33,192.73) -- cycle ;
                %Shape: Circle [id:dp531319718425953] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (333.33,57.53) .. controls (333.33,54.55) and (335.75,52.13) .. (338.73,52.13) .. controls (341.72,52.13) and (344.13,54.55) .. (344.13,57.53) .. controls (344.13,60.52) and (341.72,62.93) .. (338.73,62.93) .. controls (335.75,62.93) and (333.33,60.52) .. (333.33,57.53) -- cycle ;
                %Shape: Circle [id:dp3989240968914449] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (320.33,222.2) .. controls (320.33,219.22) and (322.75,216.8) .. (325.73,216.8) .. controls (328.72,216.8) and (331.13,219.22) .. (331.13,222.2) .. controls (331.13,225.18) and (328.72,227.6) .. (325.73,227.6) .. controls (322.75,227.6) and (320.33,225.18) .. (320.33,222.2) -- cycle ;
                %Shape: Circle [id:dp9668933955857892] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (170,52.2) .. controls (170,49.22) and (172.42,46.8) .. (175.4,46.8) .. controls (178.38,46.8) and (180.8,49.22) .. (180.8,52.2) .. controls (180.8,55.18) and (178.38,57.6) .. (175.4,57.6) .. controls (172.42,57.6) and (170,55.18) .. (170,52.2) -- cycle ;

                % Text Node
                \draw (247.4,172) node    {$\mathrm{In}_{0}$};
                % Text Node
                \draw (493.92,117.1) node    {$\mathrm{Out}_{0}$};
                % Text Node
                \draw (140.77,104.27) node [anchor=south east] [inner sep=0.75pt]    {$u$};
                % Text Node
                \draw (369.49,130.37) node [anchor=south west] [inner sep=0.75pt]    {$v$};
                % Text Node
                \draw (340.73,54.13) node [anchor=south west] [inner sep=0.75pt]    {$a$};
                % Text Node
                \draw (327.73,225.6) node [anchor=north west][inner sep=0.75pt]    {$b$};
                % Text Node
                \draw (173.4,48.8) node [anchor=south east] [inner sep=0.75pt]    {$x$};
                % Text Node
                \draw (348.73,189.33) node [anchor=south east] [inner sep=0.75pt]    {$y$};
            \end{tikzpicture}
        \end{figure}\noindent
        Ну, тут $K_{3,3}$ налицо. Первая доля состоит из вершин $v$, $b$ и $x$, вторая~--- из $u$, $a$ и $y$.\\
        И на самом деле почти во всех случаях мы будем находить $K_{3,3}$ и только в одном найдём $K_5$. случай там такой:
        \begin{figure}[H]
            \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                %Straight Lines [id:da9587546719834164] 
                \draw    (142.77,107.67) -- (213.7,154.45) ;
                %Straight Lines [id:da6263691313944992] 
                \draw    (367.49,133.77) -- (289.3,172) ;
                %Straight Lines [id:da5165707185850743] 
                \draw    (338.73,57.53) -- (273.2,148.95) ;
                %Straight Lines [id:da8842732332896879] 
                \draw    (281.2,188.45) -- (325.73,222.2) ;
                %Straight Lines [id:da05979547244610006] 
                \draw    (338.73,57.53) -- (462.7,93.15) ;
                %Straight Lines [id:da10700468280984254] 
                \draw    (325.73,222.2) -- (484.2,160.65) ;
                %Straight Lines [id:da7719164346025176] 
                \draw  [dash pattern={on 4.5pt off 4.5pt}]  (142.77,107.67) -- (367.49,133.77) ;
                %Shape: Ellipse [id:dp6351442582714808] 
                \draw   (205.5,172) .. controls (205.5,156.26) and (224.26,143.5) .. (247.4,143.5) .. controls (270.54,143.5) and (289.3,156.26) .. (289.3,172) .. controls (289.3,187.74) and (270.54,200.5) .. (247.4,200.5) .. controls (224.26,200.5) and (205.5,187.74) .. (205.5,172) -- cycle ;
                %Shape: Ellipse [id:dp16105115201202969] 
                \draw   (457,117.1) .. controls (457,92.41) and (473.53,72.4) .. (493.92,72.4) .. controls (514.31,72.4) and (530.84,92.41) .. (530.84,117.1) .. controls (530.84,141.79) and (514.31,161.8) .. (493.92,161.8) .. controls (473.53,161.8) and (457,141.79) .. (457,117.1) -- cycle ;
                %Shape: Circle [id:dp4843311991817585] 
                \draw   (140.06,133.77) .. controls (140.06,70.97) and (190.97,20.06) .. (253.77,20.06) .. controls (316.58,20.06) and (367.49,70.97) .. (367.49,133.77) .. controls (367.49,196.58) and (316.58,247.49) .. (253.77,247.49) .. controls (190.97,247.49) and (140.06,196.58) .. (140.06,133.77) -- cycle ;
                %Shape: Circle [id:dp9950697085260289] 
                \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (362.09,133.77) .. controls (362.09,130.79) and (364.5,128.37) .. (367.49,128.37) .. controls (370.47,128.37) and (372.89,130.79) .. (372.89,133.77) .. controls (372.89,136.76) and (370.47,139.17) .. (367.49,139.17) .. controls (364.5,139.17) and (362.09,136.76) .. (362.09,133.77) -- cycle ;
                %Shape: Circle [id:dp23061305390954878] 
                \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (137.37,107.67) .. controls (137.37,104.68) and (139.78,102.27) .. (142.77,102.27) .. controls (145.75,102.27) and (148.17,104.68) .. (148.17,107.67) .. controls (148.17,110.65) and (145.75,113.07) .. (142.77,113.07) .. controls (139.78,113.07) and (137.37,110.65) .. (137.37,107.67) -- cycle ;
                %Shape: Circle [id:dp531319718425953] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (333.33,57.53) .. controls (333.33,54.55) and (335.75,52.13) .. (338.73,52.13) .. controls (341.72,52.13) and (344.13,54.55) .. (344.13,57.53) .. controls (344.13,60.52) and (341.72,62.93) .. (338.73,62.93) .. controls (335.75,62.93) and (333.33,60.52) .. (333.33,57.53) -- cycle ;
                %Shape: Circle [id:dp3989240968914449] 
                \draw  [fill={rgb, 255:red, 255; green, 255; blue, 255 }  ,fill opacity=1 ] (320.33,222.2) .. controls (320.33,219.22) and (322.75,216.8) .. (325.73,216.8) .. controls (328.72,216.8) and (331.13,219.22) .. (331.13,222.2) .. controls (331.13,225.18) and (328.72,227.6) .. (325.73,227.6) .. controls (322.75,227.6) and (320.33,225.18) .. (320.33,222.2) -- cycle ;

                % Text Node
                \draw (247.4,172) node    {$\mathrm{In}_{0}$};
                % Text Node
                \draw (493.92,117.1) node    {$\mathrm{Out}_{0}$};
                % Text Node
                \draw (140.77,104.27) node [anchor=south east] [inner sep=0.75pt]    {$u$};
                % Text Node
                \draw (369.49,130.37) node [anchor=south west] [inner sep=0.75pt]    {$v$};
                % Text Node
                \draw (340.73,54.13) node [anchor=south west] [inner sep=0.75pt]    {$a$};
                % Text Node
                \draw (327.73,225.6) node [anchor=north west][inner sep=0.75pt]    {$b$};
            \end{tikzpicture}
        \end{figure}\noindent
        Причём на самом деле $K_5$ мы найдём не совсем в таком случае. Случай с картинки делится ещё на 2 под-случая: когда внутри $\mathrm{In_0}$ есть вершина, соединённая с $a$, $b$, $u$ и $v$ непересекающимися путями, и когда такой нет. И вот когда такая есть, только тогда мы найдём $K_5$ (собственно, из этой вершины и $a$, $b$, $u$ и $v$). Если нет, там будет $K_{3,3}$.
    \end{proof}
    \paragraph{Раскраски графа.}
    \begin{definition}
        Пусть дан $G$~--- неориентированный граф и отображение $c\colon V\to[1:k]$. При этом выполнено условие $\forall uv\in E~c(u)\neq c(v)$. Тогда $c$ называется \textbf{(корректной) раскраской} графа $G$ в $k$ цветов.
    \end{definition}
    \begin{definition}
        \textbf{$k$-раскрашиваемый граф}~--- граф, который можно покрасить в $k$ цветов. Также он называется \textbf{$k$-дольным}.
    \end{definition}
    \begin{claim}
        В планарном графе существует вершина степени $\leqslant 5$.
    \end{claim}
    \begin{proof}
        Следует из $E\leqslant 3V-6$.
    \end{proof}
    \begin{theorem}
        Любой планарный граф можно раскрасить в 6 цветов.
    \end{theorem}
    \begin{proof}
        Индукция по числу вершин. База ясно, в переходе удалим вершину степени $\leqslant 5$, покрасим, вернём, останется лишний цвет.
    \end{proof}
    \begin{theorem}[Теорема Хивуда]
        Любой планарный граф можно раскрасить в 5 цветов.
    \end{theorem}
    \begin{proof}
        Рассмотрим вершину $u~\deg u\leqslant5$. Если $\deg u<5$, мы см. предыдущую теорему. Если среди соседей вершины $u$ есть не все цвета~--- тоже. А что есть есть все? Давайте пронумеруем соседей $u$ по часовой стрелке и перенумеруем цвета в соответствии с этим порядком. Связаны ли 1 и 3 вершина? Если нет, то возьмём все вершины цветов 1 и 3 (связанные с нашей вершиной цвета 3) перекрасим в противоположный цвет. Если же 1 и 3 связаны, то рассмотрим 2 и 4, и сделаем с ними то же самое. 2 и 4 связаны точно быть не могут, им мешает планарность и путь из 1 в 3.
    \end{proof}
    \begin{theorem}
        Любой планарный граф можно раскрасить в 4 цвета.
    \end{theorem}
    \begin{remark}
        К чему нам нужна раскраска графов? Это напрямую связано с раскрасками карт. Пусть у нас есть какие-то средневековые княжества, никакие 4 границы в одной точке не сходятся, нет анклавов и прочих приколов. И это сейчас у нас куча цветов, а в средние века краски были дороги. И хочется использовать минимум красок.\\
        Понятно, что в 3 нельзя (рассмотрите $K_4$). И во времена Эйлера была сформулирована гипотеза о 4 красках, что всегда можно в 4 цвета. Никто не мог ни доказать, ни опровергнуть. Где-то в середине 20 века был получен следующий результат: существует конечное множество графов, что если каждый из них красится в 4 цвета, то любой граф точно красится. И были оценки на размер этого множества. Дальше во второй половине XX века людям пришла в голову идея построить это множество и перебрать все. В 1976 Аппель и Хакен написали программу, получили 1936 графов, каждый из которых раскрасили. Но научное сообщество знатно охренело, и разгорелся спор о том, насколько это легально вообще. Но в 2005 доказательство было представлено на Coq, и после этого все согласились.
    \end{remark}
    \begin{remark}
        Остаётся лишь сделать алгоритм проверки графа на то, красится ли он в 3 цвета. Но, увы, даже для планарных графов задача NP-полна.
    \end{remark}
    \begin{definition}
        $p_G(t)$~--- количество способов покрасить граф $G$ в $t$ цветов~--- \textbf{хроматический полином}.
    \end{definition}
    \begin{example}
        \begin{itemize}
            \item $p_{\overline{K_n}}(t)=t^n$.
            \item $p_{K_n}(t)=t(t-1)(t-2)\cdots(t-n+1)=t^{\underline n}$.
            \item Пусть $T$~--- дерево. Подвесим дерево, первую вершину красим в $t$, остальные в $t-1$ цвет: $p_T(t)=t(t-1)^{n-1}$.
        \end{itemize}
    \end{example}
    \begin{theorem}
        Пусть $uv\in EG$. Тогда $p_G(t)=p_{G\setminus uv}(t)-p_{G/uv}(t)$.
    \end{theorem}
    \begin{proof}
        Самое сложное здесь~--- понять, что такое $G/uv$. А это когда вы берёте граф и объединяете $u$ и $v$ в одну вершину, к которой теперь идут все рёбра, инцидентные $u$ или $v$.\\
        Дальше доказать это очень просто: берём раскраску $G\setminus uv$. Она нам либо подходит, либо нет. Когда нет? Когда $u$ и $v$ покрашены в один цвет. Ну так это корректная раскраска $G/uv$. Все такие раскраски вычтем, получим что хотим.
    \end{proof}
    \begin{theorem}
        $p_G(t)$~--- многочлен по $t$. При этом:
        $$
        p_G(t)=t^n-mt^{n-1}+a_{n-2}t^{n-2}-a_{n-3}t^{n-3}+\cdots\pm a_kt^k
        $$
        где $k$~--- количество компонент связности.
    \end{theorem}
    \begin{proof}
        Будем вести индукцию по чисту вершин и рёбер. В $G\setminus uv$ на одно ребро меньше, в $G/uv$ на одну вершину. Если вычесть, мы сразу получим всё, что хотим, кроме компонент связности (а именно степень многочлена, коэффициент при $t^{n-1}$ и знакочередование). Теперь вопрос в компонентах связности. Если мы сожмём, количество компонент связности не изменится. Если мы уберём ребро, количество компонент связности либо увеличится, либо не изменится. Итого у нас $a_k$ будет либо как в $G/uv$, либо больше.
    \end{proof}
    \begin{corollary}
        $G$ дерево тогда и только тогда, когда $p_G(t)=t(t-1)^{n-1}$.
    \end{corollary}
    \begin{definition}
        Минимальное число цветов, в которое можно покрасить граф $G$ называется \textbf{хроматическим числом} и обозначается $\chi_G$.
    \end{definition}
    \begin{lemma}
        Пусть $G$~--- не регулярный граф. Тогда $\chi(G)\leqslant\Delta(G)$.
    \end{lemma}
    \begin{proof}
        Рассмотрим вершину не максимальной степени $u$. Если граф не связен, рассмотрим каждую компоненту отдельно. Занумеруем вершины графа в порядке убывания расстояния до $u$. Выполним жадную раскраску в этом порядке. У нас на каждом этапе, кроме последнего, будет хотя бы один непокрашенный сосед, а значит в $\Delta$ цветов можно покрасить. А на последнем этапе мы посмотрим на $u$, у неё степень меньше $\Delta$, значит тоже можно покрасить.
    \end{proof}
    \begin{definition}
        $\kappa(G)$~--- минимальное число вершин, которое можно удалить, чтобы $G$ потеряет связность.
    \end{definition}
    \begin{theorem}[Теорема Брукса]
        Если $G$~--- не $K_m$ и не цикл нечётной длины, то $\chi_G\leqslant\Delta(G)$.
    \end{theorem}
    \begin{proof}
        Рассмотрим несколько случаев.
        \begin{enumerate}
            \item Пусть $\kappa(G)=1$. Тогда у нас есть точка сочленения, расчленим её, покрасим две полученные компоненты связности по лемме (степень точки сочленения изменилась, значит граф перестал быть регулярным), объединив обратно, попутно перенумеровав цвета в одной из компонент.
            \item Пусть $\kappa(G)=2$. Тогда у нас есть две вершины, которые мы удаляем ($a$ и $b$). Если они соединены ребром, сделаем то же самое, что в случае раньше. Если они не соединены ребром, то у нас могут быть проблемы с тем, что у нас в одной раскраске они одного цвета, а в другой~--- разного. Тогда мы очень хотим добавить ребро $ab$ во все компоненты связности.
            \begin{figure}[H]
                \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                    %Shape: Circle [id:dp3541434208719394] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (255.2,160) .. controls (255.2,157.02) and (257.62,154.6) .. (260.6,154.6) .. controls (263.58,154.6) and (266,157.02) .. (266,160) .. controls (266,162.98) and (263.58,165.4) .. (260.6,165.4) .. controls (257.62,165.4) and (255.2,162.98) .. (255.2,160) -- cycle ;
                    %Shape: Circle [id:dp24647657401289957] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (271.2,49) .. controls (271.2,46.02) and (273.62,43.6) .. (276.6,43.6) .. controls (279.58,43.6) and (282,46.02) .. (282,49) .. controls (282,51.98) and (279.58,54.4) .. (276.6,54.4) .. controls (273.62,54.4) and (271.2,51.98) .. (271.2,49) -- cycle ;
                    %Shape: Circle [id:dp5579177771154191] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (314.2,153) .. controls (314.2,150.02) and (316.62,147.6) .. (319.6,147.6) .. controls (322.58,147.6) and (325,150.02) .. (325,153) .. controls (325,155.98) and (322.58,158.4) .. (319.6,158.4) .. controls (316.62,158.4) and (314.2,155.98) .. (314.2,153) -- cycle ;
                    %Shape: Circle [id:dp5724108870938078] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (314.2,273) .. controls (314.2,270.02) and (316.62,267.6) .. (319.6,267.6) .. controls (322.58,267.6) and (325,270.02) .. (325,273) .. controls (325,275.98) and (322.58,278.4) .. (319.6,278.4) .. controls (316.62,278.4) and (314.2,275.98) .. (314.2,273) -- cycle ;
                    %Shape: Circle [id:dp11245740917295022] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (366.2,46) .. controls (366.2,43.02) and (368.62,40.6) .. (371.6,40.6) .. controls (374.58,40.6) and (377,43.02) .. (377,46) .. controls (377,48.98) and (374.58,51.4) .. (371.6,51.4) .. controls (368.62,51.4) and (366.2,48.98) .. (366.2,46) -- cycle ;
                    %Shape: Circle [id:dp9740639314828261] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (402.2,159) .. controls (402.2,156.02) and (404.62,153.6) .. (407.6,153.6) .. controls (410.58,153.6) and (413,156.02) .. (413,159) .. controls (413,161.98) and (410.58,164.4) .. (407.6,164.4) .. controls (404.62,164.4) and (402.2,161.98) .. (402.2,159) -- cycle ;
                    %Curve Lines [id:da004565346887659416] 
                    \draw    (276.6,49) .. controls (159.8,-11) and (166.8,246) .. (260.6,160) ;
                    %Curve Lines [id:da028209260811515646] 
                    \draw    (319.6,153) .. controls (285.8,177) and (296.8,255) .. (319.6,273) ;
                    %Curve Lines [id:da5115797200976935] 
                    \draw    (407.6,159) .. controls (477.8,198) and (523.8,-11) .. (371.6,46) ;
                    %Curve Lines [id:da03568350921924668] 
                    \draw    (319.6,153) .. controls (339.8,182) and (340.8,220) .. (319.6,273) ;
                    %Straight Lines [id:da04311744716768606] 
                    \draw  [dash pattern={on 4.5pt off 4.5pt}]  (276.6,49) -- (260.6,160) ;
                    %Straight Lines [id:da8573268847719253] 
                    \draw  [dash pattern={on 4.5pt off 4.5pt}]  (371.6,46) -- (407.6,159) ;
                    %Curve Lines [id:da015268853778678482] 
                    \draw  [dash pattern={on 4.5pt off 4.5pt}]  (319.6,153) .. controls (382.8,143) and (378.8,280) .. (319.6,273) ;

                    % Text Node
                    \draw (278.6,45.6) node [anchor=south west] [inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (321.6,149.6) node [anchor=south west] [inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (369.6,42.6) node [anchor=south east] [inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (262.6,163.4) node [anchor=north west][inner sep=0.75pt]    {$b$};
                    % Text Node
                    \draw (317.6,276.4) node [anchor=north east] [inner sep=0.75pt]    {$b$};
                    % Text Node
                    \draw (405.6,162.4) node [anchor=north east] [inner sep=0.75pt]    {$b$};
                \end{tikzpicture}
            \end{figure}\noindent
            Мы не можем его добавить только если какая-то компонента связности станет регулярной. То есть в одной из них степень всех вершин, кроме $a$ и $b$ равна $\Delta$, а у $a$ и $b$~--- $\Delta-1$. Тогда компонент всего две и во второй у $a$ и $b$ степень 1. 
            \begin{figure}[H]
                \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                    %Shape: Circle [id:dp3541434208719394] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (255.2,198) .. controls (255.2,195.02) and (257.62,192.6) .. (260.6,192.6) .. controls (263.58,192.6) and (266,195.02) .. (266,198) .. controls (266,200.98) and (263.58,203.4) .. (260.6,203.4) .. controls (257.62,203.4) and (255.2,200.98) .. (255.2,198) -- cycle ;
                    %Shape: Circle [id:dp24647657401289957] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (271.2,87) .. controls (271.2,84.02) and (273.62,81.6) .. (276.6,81.6) .. controls (279.58,81.6) and (282,84.02) .. (282,87) .. controls (282,89.98) and (279.58,92.4) .. (276.6,92.4) .. controls (273.62,92.4) and (271.2,89.98) .. (271.2,87) -- cycle ;
                    %Shape: Circle [id:dp11245740917295022] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (366.2,84) .. controls (366.2,81.02) and (368.62,78.6) .. (371.6,78.6) .. controls (374.58,78.6) and (377,81.02) .. (377,84) .. controls (377,86.98) and (374.58,89.4) .. (371.6,89.4) .. controls (368.62,89.4) and (366.2,86.98) .. (366.2,84) -- cycle ;
                    %Shape: Circle [id:dp9740639314828261] 
                    \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (402.2,197) .. controls (402.2,194.02) and (404.62,191.6) .. (407.6,191.6) .. controls (410.58,191.6) and (413,194.02) .. (413,197) .. controls (413,199.98) and (410.58,202.4) .. (407.6,202.4) .. controls (404.62,202.4) and (402.2,199.98) .. (402.2,197) -- cycle ;
                    %Curve Lines [id:da004565346887659416] 
                    \draw    (276.6,87) .. controls (159.8,27) and (166.8,284) .. (260.6,198) ;
                    %Curve Lines [id:da5115797200976935] 
                    \draw    (407.6,197) .. controls (477.8,236) and (523.8,27) .. (371.6,84) ;
                    %Straight Lines [id:da04311744716768606] 
                    \draw  [dash pattern={on 4.5pt off 4.5pt}]  (276.6,87) -- (260.6,198) ;
                    %Straight Lines [id:da8573268847719253] 
                    \draw  [dash pattern={on 4.5pt off 4.5pt}]  (371.6,84) -- (407.6,197) ;
                    %Straight Lines [id:da6813613294674061] 
                    \draw    (371.6,84) -- (412.8,84) ;
                    %Straight Lines [id:da3403649484299003] 
                    \draw    (371.6,84) -- (413.8,93) ;
                    %Straight Lines [id:da32893816103547535] 
                    \draw    (371.6,84) -- (408.8,103) ;
                    %Straight Lines [id:da6741996837870379] 
                    \draw    (407.6,197) -- (443.8,187) ;
                    %Straight Lines [id:da7842358279736754] 
                    \draw    (407.6,197) -- (435.8,176) ;
                    %Straight Lines [id:da680686092703501] 
                    \draw    (407.6,197) -- (425.8,169) ;
                    %Straight Lines [id:da5838664251320986] 
                    \draw    (220.8,109) -- (276.6,87) ;
                    %Straight Lines [id:da7761134022447498] 
                    \draw    (213.8,168) -- (260.6,198) ;

                    % Text Node
                    \draw (278.6,83.6) node [anchor=south west] [inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (369.6,80.6) node [anchor=south east] [inner sep=0.75pt]    {$a$};
                    % Text Node
                    \draw (262.6,201.4) node [anchor=north west][inner sep=0.75pt]    {$b$};
                    % Text Node
                    \draw (405.6,200.4) node [anchor=north east] [inner sep=0.75pt]    {$b$};
                \end{tikzpicture}
            \end{figure}\noindent
            И тогда если у них общий сосед, можно покрасить их хоть в разные цвета, хоть в 1 (тут мы используем то, что $\Delta>2$). А если разные соседи, то можно заменить $b$ на её соседа, они тоже будут разделять вершины, и это предыдущий случай.
            \item Пусть $\kappa(G)>2$. То есть удаление никаких двух вершин не разделяет граф. Рассмотрим вершину $x$. Какие-то два её соседа не соединены ребром (по неполноте $G$). Назовём их $a$ и $b$. Упорядочим вершины по убыванию расстояния от $x$ в графе $G\setminus\{a,b\}$ (он связен из-за $\kappa(G)>2$). Раскрасим $a$ и $b$ в первый цвет, а дальше используем жадную раскраску. У нас не будет проблем ни с $x$ (у неё два соседа одного цвета), ни с остальными вершинами.
        \end{enumerate}
    \end{proof}
    \begin{definition}
        \textbf{Инвариантом} графа называется некоторая его характеристика, не меняющееся при изоморфизме.
    \end{definition}
    \begin{remark}
        И тут уже есть вопросы: можно ли проверять изоморфность быстро? С одной стороны, мы не умеем делать это полиномиально, но и доказывать NP-полноту также не умеем (более того, предположив её NP-полноту, получим очень сомнительные (но не факт, что неверные) следствия).
    \end{remark}
    \paragraph{Паросочетания.}
    \begin{definition}
        \textbf{Паросочетанием} в графе называется множество рёбер, такое что никакие два не имеют общую вершину. \textbf{Размером паросочетания} называется количество его рёбер. Размер максимального паросочетания обозначается $\alpha'(G)$.
    \end{definition}
    \begin{definition}
        \textbf{Независимым множеством} или \textbf{антикликой} в графе называется множество вершин, такое что никакие две не соединены ребром. Размер максимальной антиклики обозначается $\alpha(G)$.
    \end{definition}
    \begin{definition}
        \textbf{Вершинным покрытием} графа называется множество вершин, такое что хотя бы один из концов любого ребра лежит в нём. Размер минимального вершинного покрытия обозначается $\beta(G)$.
    \end{definition}
    \begin{definition}
        \textbf{Рёберным покрытием} графа называется множество рёбер, такое что каждая вершина инцидентна хотя бы одному ребру. Размер минимального вершинного покрытия обозначается $\beta'(G)$.
    \end{definition}
    \begin{definition}
        \textbf{Вершинным доминирующим множеством} графа называется такое множество вершин, что любая вершина либо лежит в нём, либо имеет соседа в этом множестве. Размер минимального вершинного доминирующего множества обозначается $\gamma(G)$.
    \end{definition}
    \begin{definition}
        \textbf{Рёберным доминирующим множеством} графа называется такое множество рёбер, что любое ребро либо лежит в нём, имеет общую вершину с каким-то ребром множества. Размер минимального рёберного доминирующего множества обозначается $\gamma'(G)$.
    \end{definition}
    \begin{claim}
        $\alpha(G)+\beta(G)=n$
    \end{claim}
    \begin{proof}
        Очевидно, если $A$~--- независимое множество, то $V\setminus A$~--- вершинное покрытие.
    \end{proof}
    \begin{definition}
        Вершина называется \textbf{покрытой} паросочетанием, если в паросочетании есть ребро с концом в ней. Иначе вершина называется \textbf{свободной}.
    \end{definition}
    \begin{definition}
        Паросочетание называется \textbf{совершенным} или \textbf{полным}, если оно покрывает все вершины.
    \end{definition}
    \begin{remark}
        Чтобы в графе существовало совершенное паросочетание необходимо, чтобы количество вершин было чётно. Но, разумеется, не достаточно.
    \end{remark}
    \begin{theorem}[Критерий Татта]
        Граф $G$ содержит совершенное паросочетание тогда и только тогда, когда $\forall A\subset V~|A|\geqslant$ количество нечётных компонент связности $G\setminus A$. Далее количество нечётных компонент называется $\operatorname{odd}$.
    \end{theorem}
    \begin{remark}
        Практического применения у этой теоремы маловато будет в силу количества подмножеств.
    \end{remark}
    \begin{remark}
        Перед доказательством обсудим, как выглядит $\mathrm{xor}$ двух паросочетаний. Это граф, в котором степень каждой вершины не больше двух. Ноль~--- когда вершина не была ни в одном, либо в обоих имело одно ребро в паросочетании. Один~--- когда вершина была только в одном паросочетании. Два~--- когда имела два разных ребра в разных паросочетаниях.\\
        При этом если оба паросочетания были полны, у нас убирается вариант 1. И получается, что граф состоит из циклов и изолированных вершин.
    \end{remark}
    \begin{proof}
        Когда мы удалим $A$ у нас какие-то пары останутся, какие-то удалятся, а у каких-то мы отрежем одну вершину из паросочетания. А значит нечётные компоненты связности должны были соединяться с $A$. Причём все с различными вершинами. Это доказательство право.\\
        Теперь влево. Предположим, что совершенного паросочетания нет, но условие выполнено (назовём условие $(*)$). Выберем из всех таких графов граф с минимальным числом вершин, а из всех с одинаковым количеством вершин~--- с максимальным числом рёбер. Заметим, что проведение нового ребра не нарушает $(*)$, а значит если $uv\notin E$, то $G\cup\{uv\}$ содержит совершенное паросочетание. Заметим, что $G$ не полон (в силу $(*)$ и отсутствия паросочетания). А значит существует ребро $uv\notin E$.\\
        Выберем $U$~--- множество вершин степени $n-1$.
        \begin{lemma}
            Все компоненты связности $G\setminus U$~--- полный граф.
        \end{lemma}
        \begin{proof}
            Предположим, что это не так. Значит в $G\setminus U$ есть компонента~--- не полный граф. Там хотя бы 3 вершины. Из одного из случаев теоремы Брукса в неполном графе есть вершина $x$ с двумя несоединёнными соседями: $y$ и $z$. При этом $x\notin U$, а значит $x$ не соединена с какой-то вершиной $w$. При этом если мы добавим $yz$, то граф будет содержать совершенное паросочетание ($M_1$). Аналогично, при добавлении $wz$ получается граф с совершенным паросочетанием $M_2$. Каждое из них содержит соответствующее ребро. Когда мы видим два паросочетания, хочется сделать им $\mathrm{xor}$. Паросочетания точно разные и оба совершенные, значит $M_1\oplus M_2$ содержит изолированные вершины и циклы. Дальше есть два варианта:
            \begin{enumerate}
                \item $xw$ и $yz$ лежат в разных циклах ($C_1$ и $C_2$ соотвественно). Тогда взяв $M_1\oplus C_2$, получим совершенное паросочетание исходного графа.
                \item Если $xw$ и $yz$ лежат в одном цикле
                \begin{figure}[H]
                    \begin{tikzpicture}[x=0.75pt,y=0.75pt,yscale=-1,xscale=1]
                        %Straight Lines [id:da3040812229473795] 
                        \draw [color={rgb, 255:red, 208; green, 2; blue, 27 }  ,draw opacity=1 ]   (300.4,76.4) -- (212.27,76.86) ;
                        %Straight Lines [id:da6176675048991476] 
                        \draw    (212.27,76.86) -- (129.27,98.86) ;
                        %Straight Lines [id:da18347097706894777] 
                        \draw [color={rgb, 255:red, 255; green, 0; blue, 0 }  ,draw opacity=1 ]   (129.27,98.86) -- (104.27,162.86) ;
                        %Straight Lines [id:da01906400682029119] 
                        \draw    (104.27,162.86) -- (158.27,212.86) ;
                        %Straight Lines [id:da9996507180334211] 
                        \draw [color={rgb, 255:red, 255; green, 0; blue, 0 }  ,draw opacity=1 ]   (158.27,212.86) -- (251.27,231.86) ;
                        %Straight Lines [id:da8521307160899989] 
                        \draw    (348.4,181.4) -- (251.27,231.86) ;
                        %Straight Lines [id:da7370743379833384] 
                        \draw [color={rgb, 255:red, 255; green, 0; blue, 0 }  ,draw opacity=1 ]   (348.4,181.4) -- (458.27,172.86) ;
                        %Straight Lines [id:da9914311549915771] 
                        \draw    (458.27,172.86) -- (517.27,105.86) ;
                        %Straight Lines [id:da18152470235789897] 
                        \draw [color={rgb, 255:red, 255; green, 0; blue, 0 }  ,draw opacity=1 ]   (394.4,75.4) -- (517.27,105.86) ;
                        %Straight Lines [id:da3880169771138211] 
                        \draw    (300.4,76.4) -- (394.4,75.4) ;
                        %Straight Lines [id:da9229960732803515] 
                        \draw [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ]   (394.4,75.4) -- (348.4,181.4) ;
                        %Straight Lines [id:da6544702202498922] 
                        \draw [color={rgb, 255:red, 74; green, 144; blue, 226 }  ,draw opacity=1 ]   (300.4,76.4) -- (348.4,181.4) ;
                        %Shape: Circle [id:dp5181938127999859] 
                        \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (295,76.4) .. controls (295,73.42) and (297.42,71) .. (300.4,71) .. controls (303.38,71) and (305.8,73.42) .. (305.8,76.4) .. controls (305.8,79.38) and (303.38,81.8) .. (300.4,81.8) .. controls (297.42,81.8) and (295,79.38) .. (295,76.4) -- cycle ;
                        %Shape: Circle [id:dp7006669657752864] 
                        \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (389,75.4) .. controls (389,72.42) and (391.42,70) .. (394.4,70) .. controls (397.38,70) and (399.8,72.42) .. (399.8,75.4) .. controls (399.8,78.38) and (397.38,80.8) .. (394.4,80.8) .. controls (391.42,80.8) and (389,78.38) .. (389,75.4) -- cycle ;
                        %Shape: Circle [id:dp3414635961528829] 
                        \draw  [fill={rgb, 255:red, 0; green, 0; blue, 0 }  ,fill opacity=1 ] (343,181.4) .. controls (343,178.42) and (345.42,176) .. (348.4,176) .. controls (351.38,176) and (353.8,178.42) .. (353.8,181.4) .. controls (353.8,184.38) and (351.38,186.8) .. (348.4,186.8) .. controls (345.42,186.8) and (343,184.38) .. (343,181.4) -- cycle ;

                        % Text Node
                        \draw (460.27,176.26) node [anchor=north west][inner sep=0.75pt]    {$w$};
                        % Text Node
                        \draw (350.4,184.8) node [anchor=north west][inner sep=0.75pt]    {$x$};
                        % Text Node
                        \draw (298.4,67.6) node [anchor=south east] [inner sep=0.75pt]    {$y$};
                        % Text Node
                        \draw (396.4,66.6) node [anchor=south west] [inner sep=0.75pt]    {$z$};
                    \end{tikzpicture}
                \end{figure}
                Тогда на правой половине этого цикла возьмём чёрные рёбра, в левой~--- красные. И ещё возьмём ребро $xz$. Ещё у нас может быть отражённая картинка, нам пришлось бы брать $yx$.
            \end{enumerate}
            В любом случае получаем противоречие.
        \end{proof}
        Когда у нас есть лемма, подставим $U$ в $(*)$. Тогда мы удалим $U$ и у нас останется набор полных графов. В полных чётного размера возьмём совершенное паросочетание, в нечётных~--- полное без одной вершины. По $(*)$ в $U$ хотя бы столько вершин, сколько надо, да ещё и каждая связана со всеми вершинами, а значит паросочетание можно дополнить до совершенного.
    \end{proof}
    \begin{definition}
        \textbf{Множеством Татта} называется $A\subset V~|A|<\operatorname{odd}(G\setminus A)$.
    \end{definition}
    \begin{remark}
        Множества Татта могут быть разными. Хочется узнать, влияет ли на что-то его <<таттовость>>.
    \end{remark}
    \begin{theorem}[Теорема Бержа]
        $n-2\alpha'(G)=\max\limits_{A\subset V}(\operatorname{odd}(G\setminus A)-|A|)$
    \end{theorem}
    \begin{proof}
        Если максимум равен нулю, см. теорему Татта. Иначе обозначит правую часть за $k$.\\
        Давайте рассмотрим $G+K_k$ (соединение всех вершин $G$ и $K_k$ <<каждая с каждой>>). Докажем, что для $G+K_k$ выполнен критерий Татта. Ну, возьмём $A\subset G+K_k$. Дальше случаи
        \begin{enumerate}
            \item $A$ пусто. Пусть исходно максимум достигался на каком-то множестве $S$. Пусть
            $$
            n'=n+\operatorname{odd}(G\setminus S)-|S|\overset{\small\operatorname{mod}2}\equiv n+\operatorname{odd}(G\setminus S)+|S|\overset{\small\operatorname{mod}2}\equiv\hspace{-4.75em}\sum\limits_{S_i\text{~--- компонента связности }G\setminus S}\hspace{-4.5em}(|S_i|\mathop\%2)+S\mathop\%2+\operatorname{odd}(G\setminus S)\mathop\%2+|S|\mathop\%2
            $$
            Это делится на 2.
            \item $K_k\not\subset A$. Тогда $G+K_k\setminus A$ связен. Если он чётен, мы победили, иначе, если в силу непустоты $A$~--- тоже.
            \item $K_k\subset A$. Тогда
            $$
            \operatorname{odd}(G+K_k\setminus A)=\operatorname{odd}(G\setminus(A\setminus K_k))\leqslant|A\setminus K_k|+k=|A|-k+k=|A|
            $$
        \end{enumerate}
        Действительно, выполнен. А значит в $G+K_k$ есть совершенное паросочетание. Когда мы удалим $K_k$ обратно, мы получим, что в $G+K_k$ есть паросочетание на $n-2k$ вершин. Это даёт нам оценку на равенство, а пример следует напрямую из теоремы Татта.
    \end{proof} 
    \begin{definition}
        \textbf{Дефицитом графа} называется величина справа в теореме Бержа.
    \end{definition}
    \begin{remark}
        Давайте поговорим о графах с нечётным числом вершин. У них от природы не бывает совершенного паросочетания. Хочется с этим что-то делать.
    \end{remark}
    \begin{definition}
        $G$ называется фактор-критическим, если $\forall u\in V~G\setminus v$ содержит совершенное паросочетание
    \end{definition}
    \begin{remark}
        Кто такой этот фактор?
    \end{remark}
    \begin{definition}
        Пусть $V=\{u_1;u_2;\ldots;u_n\}$, $f_1,f_2,\ldots f_n\in\mathbb N$. Тогда \textbf{$f$-фактором} графа называется граф из тех же вершин с $\deg u_i=f_i$.\\
        $(d,d,d,d,\ldots,d)$-фактор называется \textbf{$d$-фактором}.
    \end{definition}
    \begin{example}
        Например, паросочетание~--- $1$-фактор.
    \end{example}
    \begin{claim}
        Гамильтонов граф с нечётным числом вершин является фактор-критическим.
    \end{claim}
    \begin{proof}
        Удалим случайную вершину, паросочетание сделаем из рёбер цикла.
    \end{proof}
    \begin{claim}
        Граф является фактор-критическим тогда и только тогда, когда $\forall u\in V~\alpha'(G\setminus s)=\alpha'(G)$.
    \end{claim}
    \begin{proof}
        Вправо понятно, докажем влево.\\
        Воспользуемся формулой Бержа:
        $$
        n-2\alpha'(G)=\max\limits_{A\subset V}(\operatorname{odd}(G\setminus A)-|A|)
        $$
        Пусть $A$~--- множество, на котором достигается максимум в формуле Бержа. Дальше случаи:
        \begin{enumerate}
            \item Если $A=\varnothing$, то $\operatorname{odd}(G\setminus A)\leqslant1$, а значит $\alpha'=\left\lfloor\frac n2\right\rfloor$.
            \item Пусть $A\neq\varnothing$. Рассмотрим $v\in A$. Пусть $G'=G\setminus v$, $A'=A\setminus v$. Известно, что $\alpha'(G)=\alpha'(G')$. Тогда верно следующее
            $$
            n-2\alpha'(G)=\operatorname{odd}(G\setminus A)-|A|
            $$
            $$
            n-1-2\alpha'(G')=\operatorname{odd}(\underbrace{G'\setminus A'}_{=G\setminus A})-|A'|
            $$
            Отсюда следует, что $2=0$, противоречие.
        \end{enumerate}
    \end{proof}
    \begin{corollary}
        Единственное множество Татта фактор-критического графа~--- пустое.
    \end{corollary}
    \begin{remark}
        Давайте теперь вот каким вопросом зададимся: как в графе выглядят все максимальные паросочетания? Оказывается, любой граф делится на 3 части ($C$, $A$, $D$) такие, что
        \begin{enumerate}
            \item $\forall u\in D$ существует максимальное паросочетание, не покрывающее $u$.
            \item $A$~--- соседи $D$.
            \item $C$~--- все остальные.
        \end{enumerate}
        Но это понятно, что так можно разделить. Но что интересно, эти множества обладают интересными свойствами:
        \begin{enumerate}
            \item $C$ содержит полное паросочетание.
            \item Все вершины $A$ покрыты рёбрами любого максимального паросочетания.
            \item $D$~--- набор фактор-критических графов. Причём все максимальные паросочетания $G$ выделяют в каждом из этих графов почти максимальное паросочетание.
        \end{enumerate}
    \end{remark}
    \begin{definition}
        То, что написано в заметке выше~--- \textbf{декомпозиция Эдмондса~--- Галлаи}:\\
        Рассмотрим граф $G$. Пусть
        $$D(G)=\{u\in V\mid \exists\text{максимальное паросочетание, не покрывающее }u\}$$
        $$
        A(G)=\{u\notin D\mid \exists v\in D~uv\in E\}
        $$ 
        $$
        C(G)-V\setminus(A\cup D)
        $$
    \end{definition}
    \begin{lemma}[Лемма о стабильности]
        Пусть $a\in A(G)$. Тогда
        \begin{multicols}{2}
            \begin{itemize}
                \item $$D(G\setminus a)=D(G)$$
                \item $$A(G\setminus a)=A(G)\setminus a$$
                \item $$C(G\setminus a)=C(G)$$
                \item $$\alpha'(G\setminus a)=\alpha'(G)-1$$
            \end{itemize}
        \end{multicols}
    \end{lemma}
    \begin{remark}
        Это чудо можно применить по очереди ко всем вершинам $A$ и получить те свойства, что мы описывали в заметке выше.
    \end{remark}
    \begin{proof}
        Известно, что
        $$
        \alpha'(G)-1\leqslant\alpha'(G\setminus a)\leqslant\alpha'(G)
        $$
        В последнем равенство невозможно, потому что $a\notin D$, а значит любое максимальное паросочетание покрывает $a$, отсюда верно равенство в первом неравенстве.\\
        Докажем, что $D(G\setminus a)=D(G)$. Для этого докажем двойное включение.
        \begin{itemize}
            \item $D(G)\subset D(G\setminus a)$.\\
            Рассмотрим $u\in D(G)$. Существует $M_u$~--- максимальное паросочетание, не покрывающее $u$. Пусть $ab\in M_u$, но тогда $M_u\setminus ab$~--- максимальное паросочетание в $G\setminus a$, не покрывающее $u$. Всё.
            \item $D(G)\supset D(G\setminus a)$.\\
            Рассмотрим $u\in D(G\setminus a)$. Существует максимальное паросочетание $M'_u$ в $G\setminus a$, не покрывающее $u$. Пусть $w$~--- сосед $a$ в $D$. Пусть $w$~--- сосед $a$ в $D$. Существует максимальное паросочетание $M_w$ в $G$, не покрывающее $w$. Если оно не покрывает $u$, $u\in D(G)$, а значит мы доказали. Пусть не покрывает. Рассмотрим $M_w\oplus M'_u$.\\
            $M'_u$ не покрывает $u$. $M'_u$ не покрывает $a$ ($M'_u$~--- паросочетание $G\setminus a$). $w$ не покрыто $M_w$.\\
            % restore
            % https://neerc.ifmo.ru/wiki/index.php?title=%D0%94%D0%B5%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%B7%D0%B8%D1%86%D0%B8%D1%8F_%D0%AD%D0%B4%D0%BC%D0%BE%D0%BD%D0%B4%D1%81%D0%B0-%D0%93%D0%B0%D0%BB%D0%BB%D0%B0%D0%B8
            Рассмотрим второй конец пути $u$. Если там не $a$ и не ребро $M_w$, $M'_u$~--- не максимально.\\
            Если второй конец пути $u$~--- ребро $M_w$, $M_w$ можно инвертировать, получив паросочетание, не покрывающее $u$, следовательно $u\in D(G)$.\\
            % fix
            Остаётся случай, когда наши два пути~--- один путь (с концами $a$ и $u$). Но тогда мы знаем, что $w$ не покрыт $M_w$, а значит можно добавить ребро $wa$ и перекинуть рёбра паросочетаний, получив то же самое. что в случае выше.
        \end{itemize}
        Отсюда очевидно следует, что $A(G\setminus a)=A(G)\setminus a$ и $C(G\setminus a)=C(G)$.
    \end{proof}
    \begin{theorem}[Структурная теорема Эдмондса~--- Галлаи]
        Пусть $M$~--- максимальное паросочетание $G$. Тогда
        \begin{enumerate}
            \item $M$ индуцирует совершенное паросочетание в $C$.
            \item Компоненты связности $D$~--- фактор-критические графы, в каждом из которых $M$ индуцирует почти полное паросочетание.
            \item Рёбра $M$ соединяют все вершины $A$ с какими-то вершинами из разных компонент $D$.
        \end{enumerate}
    \end{theorem}
    \begin{proof}
        Рассмотрим $a\in A$. Она покрыта $ab\in M$. $M\setminus ab$~--- максимальное паросочетание $G\setminus a$ по лемме о стабильности. Тогда $b\in D$. Сделаем так для всех вершин $A$.\\
        Что останется? Максимальное паросочетание $M'$ в $G\setminus A$. Причём $C(G\setminus A)=C(G)$, $D(G\setminus A)=D(G)$. Раз все вершины $C$ покрыты (и $A(G\setminus A)=\varnothing$), там $M'$ индуцирует совершенное паросочетание в $C$, а значит и $M$~--- тоже.\\
        Теперь рассмотрим $D_i$~--- компоненту связности $D$. $M'$ на $D_i$ индуцирует какое-то паросочетание $M'_i$. При этом для любой вершины существует максимальное паросочетание, не покрывающее её, а значит $\forall u\in D_i~\alpha'(D_i\setminus u)=\alpha'(D_i)$, следовательно $D_i$~--- фактор-критическое. При этом $M'_i$ покрывает в $D_i$ все вершины, кроме одной.
    \end{proof}
    \begin{corollary}
        $A$ является множеством Татта, причём таким, на котором достигается дефицит графа.
    \end{corollary}
    \begin{proof}
        Сколько нечётных компонент у нас останется в $G\setminus A$? Ну, столько, сколько компонент всего в $D$. А все вершины $A$ были в максимальном паросочетании.
    \end{proof}
    \section{Случайные графы.}
    \begin{remark}
        Пусть у нас происходит что-то, что зависит от параметра $p$. И в зависимости от него происходит то, что мы наблюдаем. Типа у нас есть дорога и с какой-то вероятностью пешеход её перебегает. И кажется, что результаты выборы мэра не зависит от этой вероятности. С другой стороны, если на этой дороге часто случаются проишествия, то на выборы это может повлиять. Более того, дорог у нас может быть несколько (скажем, $n$). И давайте рассмотрим эту вероятность как зависящую от $n$.\\
        Так вот вообще имеет место такой факт: оказывается, что пока вероятность элементарных исходов мала (типа $\frac1{n^3}$ или $\frac1{n^2}$), вероятность исходного события асимптотически ноль. А потом есть какая-то пороговая функция, после которой вероятность становится асимптотически равной 1. Пусть это, например, $\frac1{n\sqrt n}$. Так вот можно же взять семейство функций $\frac c{n\sqrt n}$, и тогда при каком-то конкретном $c$ будет скачок от 0 в 1.\\
        И вот такая штука наблюдается в очень многих физических или химических явлениях. Почему так~--- это какой-то метавопрос, а у нас тут математика. Но мы всё же рассмотрим некоторые системы.\\
        Существуют разные модели случайных графов, мы будем рассматривать модель Эрдёша~--- Реньи.
    \end{remark}
    \begin{definition}
        Дан неориентированный (простой) граф с $n$ вершинами. При этом для любой неориентированной пары вершин $\{u;v\}$ ребро между ними есть с вероятностью $p(n)$ (не зависящей от $u$ и $v$).\\
        Мы имеем вероятностное пространство, элементарными событиями которого являются помеченные графы на $n$ вершин. И у графа с $m$ рёбрами вероятность его равна $p^m(1-p)^{\Cnk n2-m}$. Такое пространство обозначается $G(n;p)$.
    \end{definition}
    \begin{remark}
        И это чудо мы будем рассматривать при $n\to\infty$.
    \end{remark}
    \begin{definition}
        Говорят, что $A\subset G(n;p)$ \textbf{асимптотически почти, наверное, выполнено} (а.п.н. выполнено), если его вероятность стремится к 1.
    \end{definition}
    \begin{definition}
        Говорят, что $A\subset G(n;p)$ \textbf{асимптотически почти, наверное, не выполнено} (а.п.н. не выполнено), если его вероятность стремится к 0.
    \end{definition}
    \begin{example}
        Что будет, если мы выберем $p(n)=\frac1{n^3}$? Давайте посчитаем ожидание количества рёбер:
        $$
        Em=\sum\limits_{\{u;v\}}P(uv\in EG)=\Cnk n2\frac1{n^3}=O\left(\frac1n\right)=o(1)
        $$
    \end{example}
    \begin{remark}
        То есть мы а.п.н. получим пустой граф.
    \end{remark}
    \begin{example}
        Давайте в предыдущем же примере посчитаем $P(m\geqslant 1)$. Для этого вспомним хвостовое неравенство Маркова:
        \begin{claim}
            Пусть $\xi$~--- случайная величина, принимающая неотрицательные значения. Тогда
            $$
            P(\xi\geqslant cE\xi)\leqslant\frac1c
            $$
            Эквивалентно
            $$
            P(\xi\geqslant d)\leqslant\frac{E\xi}d
            $$
        \end{claim}
        В нашем случае $d=1$. То есть
        $$P(m\geqslant1)\leqslant Em=O\left(\frac1n\right)=o(1)$$
        То есть $P(m=0)\underset{n\to\infty}\longrightarrow1$.
    \end{example}
    \begin{remark}
        Дальше нам будет впадлу писать $p(n)$, мы просто будем писать $p$.
    \end{remark}
    \begin{example}
        Распишем в общем случае:
        $$
        Em=\sum\limits_{\{u;v\}}P(uv\in EG)=\Cnk n2p=\Theta\left(n^2p\right)
        $$
        В частности, для $p=o\left(\frac1{n^2}\right)$ снова получаем пустые графы.
    \end{example}
    \begin{example}
        Посмотрим другую сторону: $p=\frac1n$. Тогда
        $$
        P(m=0)=\left(1-\frac1n\right)^{\Cnk n2}=\left(1-\frac1n\right)^{n\frac{n-1}2}\longrightarrow e^{-\frac{n-1}2}\longrightarrow0
        $$
        Не у нас два предельных перехода, но пофиг, в любом случае ноль. Давайте теперь в общем случае
        $$
        P(m=0)=\left(1-p\right)^{\Cnk n2}=\left(1-p\right)^{n\frac{n-1}2}
        $$
        Ну, когда $p$ константа, жить неинтересно, это очень быстро стремится к нулю. Поэтому давайте считать, что $p$~--- бесконечно малая. Тогда
        $$
        P(m=0)=\left(1-p\right)^{n\frac{n-1}2}\sim e^{-\frac{n^2p}2}
        $$
        Чтобы это было $o(1)$, нам надо, чтобы $n^2p=\omega(1)$ (строгая верхняя оценка).
    \end{example}
    \begin{remark}
        Вот, пожалуйста, тот самый порог. Если $p$ меньше $\frac1{n^2}$, у нас а.п.н. нет рёбер в графе, а если больше~--- у нас а.п.н. есть ребро.\\
        Понятно, что когда у нас $p$~--- функция, близкая к $\frac1{n^2}$ (с любой стороны), у нас в асимптотических оценках константа $N_0$ будет совершенно ебейшей.
    \end{remark}
    \begin{example}
        Ну, хорошо. А теперь давайте посмотрим на пороговые функции $p=\frac c{n^2}$:
        $$
        P(m=0)=\left(1-p\right)^{\Cnk n2}=\left(1-p\right)^{n\frac{n-1}2}\sim e^{-\frac c2}
        $$
        При $c=0$ это единица (что логично). Но дальше мы не наблюдем порога. В $c=\frac12$ мы достигаем $P(m=0)=\frac1e$, и у нас медленно при увеличении $c$ наша функция $P(m=0)$ плавно возрастает. Поэтому у события <<иметь ребро>> есть \textbf{асимптотический порог}, но \textbf{строгого порога} нет.
    \end{example}
    \begin{example}
        Что ж, давайте теперь рассмотрим более интересное событие $A$: в графе есть треугольник:
        $$
        \exists u,v,w~uv\in EG\land uw\in EG\land vw\in EG
        $$
    \end{example}
    \begin{definition}
        $A\subset G(n;p)$ называется \textbf{монотонным свойством}, если при дополнении любого ребра к любому графу $A$, он будет лежать в $A$.
    \end{definition}
    \begin{claim}
        Так вот оказывается, что у любого монотонного свойства есть асимптотический порог.\\
        Но докажем мы это потом.
    \end{claim}
    \begin{example}
        Итак, идём к треугольникам. Пусть $\xi$~--- случайная величина, равная количеству треугольников в графе. Чему равно её ожидание?
        $$
        E\xi=\sum\limits_{u,v,w}p^3=\Cnk n3p^3\sim n^2p^3
        $$
        Отсюда, если $p=o\left(\frac1n\right)$, то $E\xi=o(1)$, следовательно $P(\xi\geqslant1)\leqslant E\xi=o(1)$ а значит а.п.н. треугольников нет.
    \end{example}
    \begin{remark}
        То, что мы провернули в примере выше, называется \textbf{методом первого момента}:\\
        Если у нас $A\subset G(n;p)$ состоит из графов, у которых есть подграф со специальным свойством (такие ещё <<гаджетами>> называют), то мы можем взять $\xi$~--- количество таких подграфов. И если $E\xi=o(1)$, то $A$ а.п.н. равна нулю.
    \end{remark}
    \begin{example}
        Ну что ж. Что мы имеем, если $p=\omega\left(\frac1n\right)$? Да хрен его знает. Ну то есть да, мы знаем, что $E\xi\rightarrow\infty$, но отсюда совсем не следует, что $P(\xi=0)=o(1)$. Например, если мы возьмём
        $$
        \xi\colon\{0,1\}\to\mathbb N\qquad p(1)=p(0)=\frac12\qquad\xi(0)=0,\xi(1)=n
        $$
        И тут $E\xi=\frac n2$, но $P(\xi>0)=\frac12$. Ой.
    \end{example}
    \begin{remark}
        И тут имеется \textbf{метод второго момента}.
        $$
        ]M_2\xi=E\xi^2
        $$
        Рассмотрим неравенство Чебышёва:
        $$
        P((\xi-E\xi)^2\geqslant cE(\xi-E\xi)^2)\leqslant\frac1c
        $$
        Или
        $$
        P(|\xi-E\xi|\geqslant\sqrt{cD\xi})\leqslant\frac1c
        $$
        Взяв $d=\sqrt{cD\xi}$, получим
        $$
        P(|\xi-E\xi|\geqslant d)\leqslant\frac{D\xi}{d^2}
        $$
        Пусть $d=E\xi$:
        $$
        P(\xi=0)\leqslant P(|\xi-E\xi|\geqslant E\xi)\leqslant\frac{D\xi}{(E\xi)^2}
        $$
        То есть
        $$
        P(\xi=0)\leqslant\frac{E\xi^2-(E\xi)^2}{(E\xi)^2}=\frac{E\xi^2}{(E\xi)^2}-1
        $$
        При этом если мы докажем
        $$
        E\xi^2=(E\xi)^2(1+o(1))
        $$
        То получим
        $$
        P(\xi=0)\leqslant 1+o(1)-1=o(1)
        $$
        И тогда действительно будет верно, что, а.п.н. $\xi\neq0$.
    \end{remark}
    \begin{remark}
        Почему у нас так всё хорошо было с рёбрами? А потому что раскрыв количество рёбер через характеристические случайные величины, мы получим, что все они независимы, поэтому у нас всё легко и просто раскроется.
    \end{remark}
    \begin{example}
        Пусть $T_{uvw}$~--- случайная величина, равная количеству треугольников на $u,v,w$ (то есть 0 или 1). Тогда
        $$
        E\xi^2=\left(\sum\limits_{u,v,w}T_{uvw}\right)^2=\sum\limits_{u,v,w}T_{uvw}^2+\sum\limits_{\substack{u,v,w\\a,b,c}}T_{uvw}T_{abc}
        $$
        $T_{uvw}^2=T_{uvw}$, это понятно. А что с $T_{uvw}T_{abc}$? Если это 6 разных вершин, то мы можем выбрать такие вершины $\Cnk n6\Cnk63$ способами и нам надо вероятность $p^6$. Если $xyz$ и $abc$ пересекаются по одной вершине, то получаем $\Cnk n5$ способов их выбрать на $5$ способов выбрать повторяющуюся и $\Cnk 42$ способов распихать оставшиеся. И $p^6$ вероятность 6 рёбер. И если треугольники пересекаются по 2 вершинам, то имеем $\Cnk n4\Cnk 42 2p^5$.
        \[\begin{split}
            E\xi^2&=\sum\limits_{u,v,w}T_{uvw}^2+\sum\limits_{\substack{u,v,w\\a,b,c}}T_{uvw}T_{abc}=
            E\xi+\Cnk n6\Cnk63p^6+\Cnk n55\Cnk42p^6+\Cnk n4\Cnk 42 2p^5\sim\\
            &\sim E\xi+\frac{n^66!}{6!3!3!}p^6+\alpha n^5p^6+\beta n^4p^5=(E\xi)^2\left(\cancelto0{\frac1{E\xi}}+1+\cancelto0{\alpha'\frac1n}+\cancelto0{\beta'\frac1{n^2p}}\right)
        \end{split}\]
        Да, выполнено условие вторых моментов, значит всё хорошо.\\
        Мы тут использовали, что:
        $$
        E\xi=\Cnk n3p^3\sim\frac{n^3}6p^3\Longrightarrow(E\xi)^2=\frac{n^6}{6^2}p^6
        $$
    \end{example}
    \begin{example}
        Давайте вот какое свойство теперь изучать: граф имеет диаметр 2. Диаметр~--- максимальное кратчайшее расстояние между 2 вершинами (т.е. диаметр 2~--- когда каждая пара вершин связана ребром или имеет общего соседа).\\
        Давайте искать гаджет. Что считать им? Ну, давайте считать таковым несоединённую пару вершин без общего соседа. Пусть $\xi$~--- количество таких пар вершин, а $\xi_{uv}$~--- индикатор того, является ли пара вершин ${u;v}$ таковой. Тогда
        $$
        P(\xi_{uv}=1)=(1-p)\prod\limits_{i=1}^{n-2}(1-p^2)=(1-p)(1-p^2)^{n-2}
        $$
        То есть
        $$
        E\xi=\Cnk n2(1-p)(1-p^2)^{n-2}
        $$
        Хочется, чтобы это стремилось к нулю. Для начала хуй забьём на $n-2$ и будем считать, что там $n$ (скорее всего, $p$ к нулю стремится, иначе не интересно). И $\Cnk n2$ будем считать равным $n^2$. Ещё $1-p$, очевидно, к делу не относится. Тогда
        $$
        n^2(1-p^2)^n\sim n^2\left(1-p^2\right)^{\frac1{p^2}np^2}\sim n^2e^{-np^2}=e^{2\ln n-np^2}
        $$
        Чтобы это стремилось к нулю, нужно, чтобы показатель стремился к $-\infty$. Для этого нужно как минимум
        $$
        np^2>2\ln n\Leftrightarrow p^2>\frac{2\ln n}n\Leftrightarrow p>\sqrt{\frac{2\ln n}n}
        $$
        На самом деле, эта штука~--- строгий порог. Но пока мы это не доказали.
    \end{example}
    \begin{theorem}
        Если $p=\omega\left(\sqrt{\frac{\ln n}n}\right)$ или $p=\sqrt{\frac{c\ln n}n}$, где $c>2$, то $G$ а.п.н. имеет диаметр $\leqslant2$.\\
        Если $p=o\left(\sqrt{\frac{\ln n}n}\right)$ или $p=\sqrt{\frac{c\ln n}n}$, где $c<2$, то $G$ а.п.н. имеет диаметр $>2$.
    \end{theorem}
    \begin{remark}
        Если $p=\sqrt{\frac{2\ln n}n}+o\left(\sqrt{\frac{2\ln n}n}\right)$, то вероятность того, что граф имеет диаметр 2, равна некоторой константе, но это мы доказывать не будем.
    \end{remark}
    \begin{proof}
        Первое докажем только для $p=\sqrt{\frac{c\ln n}n}$, где $c>2$, $p=\omega\left(\sqrt{\frac{\ln n}n}\right)$ получится по монотонности. Так вот, тут у нас точно $p=o(1)$, и то, что мы предполагали выше, хорошо.
        $$
        E\xi\approx e^{2\ln n-c\ln n}=e^{(2-c)\ln n}\rightarrow0
        $$
        Что ж. Теперь второе.
        $$
        E\xi\approx e^{2\ln n-c\ln n}=e^{(2-c)\ln n}\rightarrow+\infty
        $$
        Но этого не хватает, надо дисперсию считать. Более того, так загрубить ожидание, как мы загрубили его раньше, нельзя. А точнее, нам надо $1+o(1)$, а не $O(1)$, поэтому вернём обратно $\Cnk n2$, точнее, заменим на $\frac{n^2}2$ вместо $n^2$.
        \[\begin{split}
            E\xi^2&=E\left(\sum\limits_{u,v}\xi_{uv}\right)=\underbrace{\sum\limits_{u,v}\xi_{uv}^2}_{E\xi}+\underbrace{\sum\limits_{\substack{u,v\\x,y}}\xi_{uv}\xi_{xy}}_{\substack{4\text{ различные вершины}\\\text{либо }1\text{ повтор}}}\sim\frac{n^{2-c}}2+\frac n2\cdot\frac n2\cdot n^{-2c}+\frac{n^3}6\cdot3\cdot2\cdot\underbrace{\left(1-p+p(1-p)^2\right)^n}_{\sim\left(1-2p^2\right)^n=n^{-2c}}=\\&=\frac12n^{2-c}+\frac14n^{4-2c}+n^{3-2c}
        \end{split}\]
        Поделим это на $(E\xi)^2$:
        $$
        \frac{\frac12n^{2-c}+\frac14n^{4-2c}+n^{3-2c}}{\frac14n^{4-2c}}=1+\cancelto0{2n^{c-2}}+\cancelto0{4n^{-1}}\qquad c<2
        $$
    \end{proof}
    \begin{remark}
        А как вообще отличить, будет у нас строгий порог (как тут) или нет (как в треугольниках)? Ну, давайте посмотрим на ожидание количества гаджетов. У треугольников было
        $$
        E\xi=\frac{(np)^3}6=\mathrm{poly}(n,p)
        $$
        И в таком случае у нас как правило строгого порога нет. А вот в случае диаметра
        $$
        E\xi=\frac12e^{2\ln p-np^2}
        $$
        И вот экспонента уже явно чувствительнее к константе, чем полином. Поэтому в таком случае обычно бывает строгий порог.
    \end{remark}
    \begin{remark}
        Теперь давайте вот на что посмотрим. Обычно в теорвере легко считать мат. ожидание, но сложно считать распределение (там регулярно вылезает какая-то упоротая сумма биномиальных коэффициентов, которую не посчитать).
    \end{remark}
    \begin{example}
        Зафиксируем вершину. У неё мат. ожидание степени $np$ примерно. Давайте теперь рассмотрим три случая:
        \begin{enumerate}
            \item $p=\mathrm{const}$.
            \item $p=\Omega\left(\frac{\log n}n\right)$.
            \item $p=\frac dn$.
        \end{enumerate}
        \begin{enumerate}
            \item Пусть $\xi_i$~--- распределение Бернулли, $\xi=\sum\limits_{i=1}^n\xi_i$, и все $\xi_i$ независимы. Тогда
            $$
            P(\xi>(1+\varepsilon)E\xi)=P(\xi>(1+\varepsilon)np)\leqslant e^{-\frac{\varepsilon^2np}3}
            $$
            $$
            P(\xi<(1-\varepsilon)E\xi)\leqslant e^{-\frac{\varepsilon^2np}3}
            $$
            Итого
            $$
            P(|\deg u-np|>\varepsilon np)<2e^{-\frac{\varepsilon^2np}3}
            $$
            То есть когда $p=\mathrm{const}$, то у нас очень мало вершин вне доверительного интервала.
            \item Мы получили вероятность того, что заданная вершина плохая. То есть вероятность того, что в графе в принципе есть вершины вне доверительного интервала, равна
            $$
            2ne^{-\frac{\varepsilon^2np}3}
            $$
            Это равно нулю тогда же, когда
            $$
            e^{\ln n-\frac{\varepsilon^2np}3}
            $$
            Это чудо стремится к нулю, когда
            $$
            \ln n<\frac{\varepsilon^2np}3\Leftrightarrow p>\frac1{\varepsilon^2}\frac{\ln n}n
            $$
            Ну и, пожалуйста, рассуждения о $\Omega\left(\frac{\log n}n\right)$
            \item Хорошо, пусть $p=\frac dn$. Посчитаем вероятность того, что степень вершины равна $k$.
            $$
            P(\deg u=k)=\Cnk nk\left(\frac dn\right)^k\left(1-\frac dn\right)^{n-k}
            $$
            Давайте считать, что $\frac kn$ бесконечно мало (иначе у нас происходят какие-то очень невероятные стечения обстоятельств). Хорошо, чему это тогда равно?
            $$
            \Cnk nk\left(\frac dn\right)^k\left(1-\frac dn\right)^{n-k}\sim\frac{n^k}{k!}\cdot\frac{d^k}{n^k}\underbrace{e^{-d\frac{n-k}n}}_{\sim e^{-d}}=\frac{d^k}{k!}e^{-d}
            $$
            Это чудо~--- распределение Пуассона. От него очень сложно избавиться. Потому что на самом деле это ряд тейлора экспоненты, а от экспоненты не избавиться.
        \end{enumerate}
    \end{example}
    \begin{theorem}
        В $G(n;\frac1n)$ существует вершина степени $\frac{\log n}{\log\log n}$ ненулевой вероятностью.
    \end{theorem}
    \begin{proof}
        Если $k=\frac{\log n}{\log\log n}$, то $k^k=\left(\frac{\log n}{\log\log n}\right)^{\frac{\log n}{\log\log n}}$, а
        $$\log k^k=\frac{\log n}{\log\log n}\cdot\left(\log\log n-\log\log\log n\right)=\log n-t(n)<\log n$$
        И отсюда $k^k<n$. А ещё $k!<k^k<n$. И отсюда
        $$
        P(\deg u=k)>\frac1n\cdot e^{-1}=\frac1{en}
        $$
        $$
        P(\text{любая вершина }\deg u<k)<\left(1-\frac1{en}\right)^n=e^{-\frac1e}
        $$
        А значит искомая вероятность равна $1-e^{-\frac1e}>0$.\\
        Тут есть ошибка в том, что мы считаем степени вершин независимыми, и эта трудность может быть обойдена, но это выходит за рамки нашего курса.
    \end{proof}
    \paragraph{Компоненты связности в случайных графах.}
    \begin{remark}
        Тут всё интересно на асимптотике $\frac1n$. До неё у нас компоненты маленькие, в ней ровно~--- компоненты размера $O(\log n)$, а после~--- появляется здоровая компонента размера $\Omega(n)$. И там на границе появляются очень интересные штуки.\\
        $G(n;\frac dn)\mid d<1$~--- а.п.н. есть только компоненты $O(\log n)$. $d=1$~--- могут быть компоненты вида $O(\log n)$ и $\Theta(n^{2/3})$. $d>1$~--- появляется компонента размера $\Omega(n)$.\\
        $G(n;\frac{c\ln n+d}n)\mid \frac12<c<1$~--- гигантская компонента и изолированные вершины. $c=1$~--- мат. ожидание числа изолированных вершин стремится к $e^{-e^{-d}}$. $c>1$~--- а.п.н. граф связен.
    \end{remark}
    \begin{theorem}
        Пусть количество изолированных вершин~--- $X_0$. Пусть $p=\frac{\ln n+d}n$. Тогда $E(X_0)\rightarrow e^{-e^{-d}}$.
    \end{theorem}
    \begin{proof}
        $P(\deg u=0)=(1-p)^{n-1}$. Пренебрежём тем, что у ребра два конца и что $[\deg u=0]$ и $[\deg v=0]$~--- немного зависимые события. Получаем распределение Бернулли, то есть
        $$P(X_0=k)=\Cnk nk(1-p)^{(n-1)k}(1-(1-p)^{n-1})^{n-k}$$
        При $k\ll n$ имеем
        $$
        P(X_0=k)\sim\frac{e^{-dk}}{k!}e^{-e^{-d}}
        $$
        Взяв мат. ожидание, получим то, что хотим.
    \end{proof}
    \begin{remark}
        Запишем формально BFS. У нас бывают вершины чёрные, белые и серые. На каждом этапе берём одну серую и смотрим на рёбра, соединяющие её с белыми. Для каждого ребра с вероятностью $p$ красим вторую вершину в серый. После этого нашу текущую вершину красим в чёрный.\\
        Как мы ищем компоненту? У нас есть $G(n;\frac dn)$. В среднем мы красим $d$ соседних вершин в серый. Чтобы у нас получилась маленькая компонента связности, случайная величина должна отклониться от своего ожидания на это самое ожидание. А если компонента связности не отвалилась, пока была маленькой, то дальше серых вершин будет очень много, и вряд ли отвалится. При $d=1$ у нас есть исключение с логарифмическим размером, а если если $d>1$, то нет, и у нас количество серых вершин растёт. Пока не получится большая компонента, у которой у серых вершин ребра будут вести не в белые, а в чёрные вершины, и тут у нас сломаются приближения. Но получится <<гигантская компонента>>. Одна, кстати (если их две, между ними слишком много рёбер).\\
        Ну, хорошо, чему равна вероятность, что $v$~--- белая после $i$ запусков DFS'а? Ну, $$P(v\text{~--- белая вершина})=(1-p)^i=\left(1-\frac dn\right)^i\sim e^{-\frac{id}n}$$
        $$P(v\text{~--- не белая вершина})=1-e^{-\frac{id}n}$$
        Пусть $N_w$, $N_g$ и $N_b$~--- количества соотвественно белых, серых и чёрных вершин после $i$ шагов. Тогда
        $$
        E(N_g)=E(n-N_w-N_g)=n-ne^{-\frac{id}n}-i
        $$
        Для маленьких $i$ разложим $e^{-\frac{id}n}$ в ряд и оставим первый член:
        $$
        E(N_g)=n-ne^{-\frac{id}n}-i\approx n-n\left(1-\frac{id}n\right)-i=i(d-1)
        $$
        Что логично, у нас будет в среднем $d-1$ новых вершин каждый раз (на ранних этапах).\\
        То есть вероятность того, что $v$~---не белая, примерно равна $\frac{id}n$.
        $$
        P(\text{не белых вершин }i\text{ после }i\text{ шагов})\approx\frac{(di)^i}{n^i}e^{-di}\approx e^{-di}\frac{d^ii^ie^i}{i^i}=e^{(-(d-1)i)}e^i=e^{-(d-1-\ln d)i}
        $$
        Когда $d=1$, получаем 1. Не очень хорошо, мы слишком многим пренебрегали.\\
        Пусть $d\neq1$, тогда $\alpha=d-1-\ln d>0$. Пусть $i>c\ln n\mid c=\mathrm{const}$.
        $$
        P(\text{не белых вершин }i\text{ после }i\text{ шагов})\approx e^{-di}<e^{-c\alpha\ln n}=n^{-c\alpha}
        $$
        Если выбрать $c$ такое что $c\alpha\geqslant1$, получим, что вероятность нашего события $o\left(\frac1n\right)$. А отсюда
        $$
        \sum\limits_{i>c\ln n}P(\text{не белых вершин }i\text{ после }i\text{ шагов})\approx o(1)
        $$
        То есть мы как раз и получаем, что для больших $i$ у нас какая-то срака. Вторая такая срака получится для совсем больших $i$, когда все наши аппроксимации перестанут работать и мы получим компоненту размера $\Omega(n)$.
    \end{remark}
    \begin{remark}
        Давайте ещё оценим мат. ожидание количества компонент размера $k$ ($EX_k$).
        $$
        EX_k\leqslant\Cnk nkk^{k-2}p^{k-2}\cdot(1-p)^{kn-k^2}
        $$
    \end{remark}
    \begin{theorem}
        Если $c>\frac12$, то $G(n;\frac{c\ln n}n)$ а.п.н. не содержит компонент размера $\geqslant 2$ (кроме гигантской).
    \end{theorem}
    \begin{proof}
        Просуммируем
        $$
        \sum\limits_{k=2}^{n/2}EX_k
        $$
        Если это стремится к нулю, то всё хорошо.\\
        Заметим, что
        $$
        \Cnk nk=\frac{n^{\underline k}}{k!}\leqslant\frac{n^k}{k!}\approx\left(\frac{en}k\right)^k
        $$
        И что
        $$
        1-p<e^{-p}
        $$
        Тогда
        \[\begin{split}
            EX_k&\leqslant\frac{e^kn^k}{k^k}k^{k-2}\frac{c^{k-1}(\ln n)^{k-1}}{n^{k-1}}e^{-\frac{c\ln n}n(kn-k^2)}=\frac{e^k}{k^2}c^{k-1}(\ln n)^{k-1}ne^{-\frac{c\ln n}n(kn-k^2)}\leqslant\\
            &\leqslant\exp\left(k-2\ln k+k\ln c+k\ln\ln n+\ln n-ck\ln n+c\ln n\frac{k^2}n\right)=\exp f(k)
        \end{split}\]
        Давайте попробуем найти минимум этой ебалы. Для этого продиффаем её дважды по $k$ и получим
        $$
        f'(k)=1-\frac2k+\ln c+\ln\ln n-c\ln n+2c\ln n\frac kn
        $$
        $$
        f''(k)=\frac1{k^2}+2c\frac{\ln n}n>0
        $$
        Это выпуклая вниз функция, а значит максимум у неё на краях (либо в 2, либо в $\frac n2$). В 2 получим $\sim(1-2c)\ln n$. В $\frac n2$~--- $\frac{-cn}4\ln n$. Максимум в точке 2, а значит
        $$
        EX_k\leqslant e^{(1-2c)\ln n}=n^{1-2c}
        $$
        Для $c>1$ всё сходится. Для $c\in\left(\frac12;1\right)$ надо посмотреть на нашу функцию $f$ внимательнее. Утверждается, что $f(k)$ имеет своим главным членом $-ck\ln n$ для маленьких $k$ и $c\ln n\frac{k^2}n$~--- для больших. Поэтому до минимума она убывает как экспонента, а потом растёт. Поэтому можно оценить её как сумму геометрической прогрессии до минимума плюс $\frac{-cn}4\ln n$~--- после.
    \end{proof}
    \section{Матроиды.}
    \begin{remark}
        Рассмотрим абстрактную постановку задачи. У нас есть конечное непустое множество каких-то объектов $X$, и есть какие-то их подмножества $A$. И мы занем, что какие-то из них <<хорошие>>, а какие-то~--- нет (<<хорошими>> могут быть линейно независимые множества векторов или ациклические множества рёбер в графе). <<Хорошесть>>~--- $I\subset 2^X$. И у нас есть весовая функция $w\colon X\to\mathbb R$. Наша цель~--- найти максимальное по включению <<хорошее>> множество минимального веса.\\
        Мы хотим, чтобы это решалось жадно. И хотим определить какие-то свойства, чтобы жадность работала.
        \begin{itemize}
            \item Чтобы мы могли начать жадность, надо $\varnothing\in I$.
            \item Чтобы жадность работала, надо $A\in I\land B\subset A\Rightarrow B\subset I$
        \end{itemize}
    \end{remark}
    \begin{definition}
        Если для $X$ и $I$ свойства выше выполнены, пара $(X;I)$ называется \textbf{системой с наследованием} или \textbf{предматроидом}.
    \end{definition}
    \begin{remark}
        Нам нужно ещё одно свойство, чтобы работал жадный алгоритм. Свойство это вот какое.
        \begin{itemize}
            \item Пусть $A,B\in I$, причём $|A|>|B|$. Тогда $\exists x\in A\setminus B~B\cup x\in I$. Здесь и далее $B\cup x$~--- объединение $B$ и $\{x\}$.
        \end{itemize}
    \end{remark}
    \begin{definition}
        Если $(X;I)$~--- система с наследованием, у которой выполнено свойство выше, то $(X;I)$ называется \textbf{матроидом}.\\
        Общепринято вместо <<хорошести>> говорить <<независимость>>. То есть элементы $I$~--- \textbf{независимые множества}.\\
        Первое свойство называется \textbf{нетривиальностью}, второе~--- \textbf{наследованием}, третье~--- \textbf{заменой}.
    \end{definition}
    \begin{example}
        \textbf{Равномерный} (\textbf{универсальный}) матроид.\\
        Характеризуется $n$ и $k$, обозначается $U_{n,k}$.
        $$X=\{1,2,\ldots,n\}\qquad\qquad I=\{A\mid |A|\leqslant k\}$$
        Проверим аксиомы:
        \begin{enumerate}
            \item Нетривиальность очевидна.
            \item Наследование очевидно.
            \item Замена: Если $k\geqslant|A|>|B|$, отсюда $|B|\leqslant k-1$, а значит для любого $x\in A\setminus B~|B\cup x|\leqslant k$, значит $B\cup x\in I$.
        \end{enumerate}
    \end{example}
    \begin{example}
        \textbf{Графовый матроид}.\\
        Пусть $G$~--- неориентированный граф. $X=EG$, $I$~--- множество ацикличных подмножеств $EG$.
        \begin{enumerate}
            \item Нетривиальность очевидна.
            \item Наследование очевидно.
            \item Замена: пусть $|A|>|B|$. Пусть $|A|=a$, $|B|=b$. Граф $(V;A)$ содержит $n-a$ компонент связности, а $(V;B)$~--- $n-b$. Утверждается, что $\exists uv\in A$, соединяющие разные компоненты связности $B$. Если это не так, то у $A$ компонент связности как минимум столько же, сколько у $B$, но это не правда. А значит такое $uv$ есть, следовательно $B\cup uv\in I$.
        \end{enumerate}
    \end{example}
    \begin{example}
        \textbf{Матричный матроид}.\\
        Рассмотрим произвольное поле $F$ и $X=\{\{x_1;x_2;\ldots;x_n\}\mid x_k\in F^m\}$. $I$ состоит из линейно независимых систем векторов.
        \begin{remark}
            Очень многие в матроидах пошли из матричного матроида (и линейной алгебры). Однако встречаются трудности перевода.
        \end{remark}
        \begin{enumerate}
            \item Нетривиальность очевидна.
            \item Наследование очевидно.
            \item Замена: пусть $|A|>|B|$. Ну раз так, $\dim\Lin A>\dim\Lin B$. А отсюда $\exists x\in A~x\notin\Lin B$. Кому неочевидно это, того уже отчислила Екатерина Аркадьевна. Отсюда понятно, что $B\cup x\in I$.
        \end{enumerate}
    \end{example}
    \begin{theorem}
        Графовый матроид~--- частный случай матричного (над $\mathbb R$). Также этот факт пишут так: <<графовый матроид \textbf{является} матричным>>.
    \end{theorem}
    \begin{proof}
        Возьмём случайные $n$ векторов (с равномерным распределением вероятности). Понятно, что вероятность того, что они не подойдут, равна нулю.\\
        Если такое вам не нравится, почитайте книжки по линейной алгебре, где написан термин <<вектора общего положения>>.
    \end{proof}
    \begin{definition}
        Максимальное по включению независимое множество называется \textbf{базой}.
    \end{definition}
    \begin{lemma}
        Все базы в матроиде равномощны.
    \end{lemma}
    \begin{proof}
        Иначе воспользуемся заменой и получим противоречие.
    \end{proof}
    \begin{definition}
        \textbf{Рангом матроида} называется мощность всех его баз.
    \end{definition}
    \begin{definition}
        \textbf{Взвешенный матроид}~--- пара из матроида и функции $w\colon X\to\mathbb R$.
    \end{definition}
    \begin{remark}
        У нас не будет алгоритмов, которые требуют неотрицательных весов, но вообще такие алгоритмы бывают.
    \end{remark}
    \begin{lemma}
        Пусть $A_k$~--- независимое множество минимального веса среди независимых множеств размера $k$. Пусть $x\notin A_k$~--- такой $x\in X$, что $x\cup A_k\in I$ и среди всех таких $x$ оно имеет минимальный вес. Тогда вес $A_k\cup x$ равен весу $A_{k+1}$.
    \end{lemma}
    \begin{proof}
        Рассмотрим $A_{k+1}$. Поскольку $|A_{k+1}|=k+1>k=|A_k|$, по аксиоме замены $\exists y\in A_{k+1}\setminus A_k~A_k\cup y\in I$. Тогда по определениям $A_{k+1}$, $A_k$ и $x$
        $$
        w(A_{k+1})=w(A_{k+1}\setminus y)+w(y)\geqslant w(A_k)+w(y)\geqslant w(A_k)+w(x)=w(A_k\cup x)\geqslant w(A_{k+1})
        $$
        Отсюда $w(A_k\cup x)=w(A_{k+1})$.
    \end{proof}
    \begin{theorem}[Алгоритм Радо~--- Эдмондса]
        Алгоритм строит базу минимального веса в данном матроиде. Работает так: отсортируем $X$ во возрастанию $w$. Дальше заведём себе множество $A$ (изначально пустое) и будем идти по множеству $x$ в указанном порядке, добавляя элементы, пока $A\cup x\in I$. В конце получим базу минимального веса.
    \end{theorem}
    \begin{proof}
        Докажем по индукции, что в любой момент $A$ является минимальным среди множеств своей мощности. База индукции верна по аксиоме нетривиальности, переход верен по наследованию и лемме (мы не можем добавить уже просмотренные элементы по наследованию, из непросмотренных добавляем минимальный, получается то что хотим по лемме).\\
        Почему $A$ максимальное по включению? Потому что иначе в него можно что-то добавить, а в него нельзя.
    \end{proof}
    \begin{example}
        \textbf{Разноцветный матроид}. Обозначение: $R$.\\
        Пусть $X$~--- некое множество, $c\colon X\to\{1,2,\ldots,k\}$. $I$ состоит из таких множеств, что все их элементы разного цвета.
        \begin{enumerate}
            \item Нетривиальность очевидна.
            \item Наследование очевидно.
            \item Замена очевидна.
        \end{enumerate}
    \end{example}
    \begin{remark}
        Мы тут занимаемся какой-то операцией, что мы делим элементы на корзины (одного цвета) и из каждой выбираем один элемент. Так вот, это название имеет.
    \end{remark}
    \begin{definition}
        Пусть $M_1,\ldots,M_k$~--- матроиды с непересекающимися носителями. Тогда \textbf{сумма матроидов} ($M_1+M_2+\cdots+M_k$)~--- конструкция следующего вида:
        $$
        X=X_1\cup X_2\cup\ldots\cup X_k\qquad\qquad I=\{A_1\cup A_2\cup\ldots\cup A_k\mid A_j\in I_j\}
        $$
    \end{definition}
    \begin{theorem}
        Сумма матроидов~--- матроид.
    \end{theorem}
    \begin{proof}
        Очевидно.
    \end{proof}
    \begin{remark}
        Несложно заметить, что $R=U_{c_1,1}+U_{c_2,1}+\cdots+U_{c_k,1}$, где $c_i$~--- количество $i$-того цвета.
    \end{remark}
    \begin{example}
        \textbf{Матроид паросочетаний}.\\
        Пусть $((L;R);E)$~--- двудольный граф. Пусть $X=L$, $I$ состоит их множеств таких вершин, что всё это множество можно покрыть паросочетанием.
        \begin{enumerate}
            \item Нетривиальность очевидна.
            \item Наследование очевидно.
            \item Замена: Пусть $|A|>|B|$. Пусть $A$ покрывается $M_A$, $B$ покрывается $M_B$. Тогда $M_A\oplus M_B$ содержит хотя бы один дополняющий путь (относительно $M_B$). У него один конец в $L$, другой~--- в $R$. Первый лежит в $A\setminus B$, а $B\cup x$ можно покрыть дополнением $M_B$ этим самым дополняющим путём.
        \end{enumerate}
    \end{example}
    \begin{remark}
        Здесь и далее $\mathfrak B$~--- множество баз матроидов.
    \end{remark}
    \begin{theorem}[Слабая теорема о базах]
        Во-первых, $\mathfrak B\neq\varnothing$.\\
        Пусть $B_1$ и $B_2$~--- различные базы, тогда $B_1\not\subset B_2$ и
        $$
        \forall x\in B_1\setminus B_2~\exists y\in B_2\setminus B_1~B_1\setminus x\cup y\in\mathfrak B
        $$
    \end{theorem}
    \begin{proof}
        Тривиально.
    \end{proof}
    \begin{definition}
        Минимальные по включению зависимые множества называются \textbf{циклами}.
    \end{definition}
    \begin{definition}
        Цикл размера 1 назвается \textbf{петлёй}.
    \end{definition}
    \begin{remark}
        Здесь и далее $\mathfrak C$~--- множество циклов.
    \end{remark}
    \begin{lemma}
        Если $A\notin I$, то $A$ содержит в себе некоторый цикл.
    \end{lemma}
    \begin{proof}
        Возьмём минимальное по мощности подмножество $A$. Оно обязано оказаться и минимальным по включению. Это же цикл!
    \end{proof}
    \begin{example}
        Как выглядят циклы в $U_{n,k}$? Это множества размера $k+1$.\\
        А в графовом матроиде? Простые циклы.\\
        А в разноцветном матроиде? Пары одноцветных элементов.\\
        В матричном матроиде не очень понятно. Ну, это сложно как-то описать, кроме как множества векторов из $k+1$ элемента, где любые $k$ линейно независимы.\\
        И в паросочетаниях циклы~--- тоже какая-то мерзкая штука.
    \end{example}
    \begin{theorem}[Теорема о циклах]
        \mbox{}
        \begin{itemize}
            \item $\varnothing\notin\mathfrak C$.
            \item $\forall C_1,C_2\in\mathfrak C:C_1\neq C_2~C_1\not\subset C_2$.
            \item Пусть $C_1,C_2$~--- разные циклы. Тогда $\forall p\in C_1\cap C_2~C_1\cup C_2\setminus p\notin I$.
        \end{itemize}
    \end{theorem}
    \begin{proof}
        Первое и второе~--- тривиально, третье~--- далее.
    \end{proof}
    \begin{remark}
        Последнее свойство обычно пишут <<$C_1\cup C_2\setminus p$ содержит цикл>>.
    \end{remark}
    \begin{definition}
        Пусть $A\subset X$. Тогда \textbf{рангом} $A$ называется число
        $$
        r(B)=\max\{|B|\mid B\subset A,B\in I\}
        $$
        Это самое множество $B$ называется \textbf{базой множества} $A$ и обозначается $b(A)$.
    \end{definition}
    \begin{theorem}[Теорема о рангах]
        \mbox{}
        \begin{enumerate}
            \item $0\leqslant r(A)\leqslant|A|$.
            \item $A\subset B\Rightarrow r(A)\leqslant r(B)$.
            \item Полумодулярность ранга:
            $$r(A\cup B)+r(A\cup B)\leqslant r(A)+r(B)$$
        \end{enumerate}
    \end{theorem}
    \begin{proof}
        1 и 2 очевидно, докажем 3.\\
        %Воспользуемся диаграммами Венна.
        %\begin{figure}[H]
        %    \begin{tikzpicture}[scale=.5]
        %        \draw (0,0) circle (5);
        %        \draw (5,0) circle (5);
        %    \end{tikzpicture}
        %\end{figure}\noindent
        Рассмотрим $S$~--- базу $A\cap B$. По лемме ниже мы можем достроить $S$ до $T$~--- базы $A$. А $T$ можно достроить до $R$~--- базы $A\cup B$. Пусть $U=R\cup B$.\\
        Тогда, тривиально,
        $$|T|+|U|=|R|+|S|$$
        При этом первое~--- $r(A)$, второе~--- нечто непонятное, но меньше $r(B)$, третье~--- $r(A\cap B)$, четвёртое~--- $r(A\cup B)$.
    \end{proof}
    \begin{lemma}
        Пусть $A\subset B$, $S=b(A)$. Тогда $\exists T:T=b(B)~S\subset T$.
    \end{lemma}
    \begin{proof}
        Если $|T|=|S|$, мы победили. Если же $|T|>|S|$, то, поскольку $T,S\in I$, можно добавить в $S$ элемент. Сделав так несколько раз, получим что нам хочется.
    \end{proof}
    \begin{lemma}
        Если $C\in\mathfrak C$,  то $r(C)=|C|-1$.
    \end{lemma}
    \begin{proof}
        Тривиально.
    \end{proof}
    \begin{proof}
        Докажем третий пункт теоремы о циклах.\\
        \[\begin{split}
            r(C_1\cup C_2)&\leqslant r(C_1)+r(C_2)-r(C_1\cup C_2)=\\
            &=|C_1|-1+|C_2|-1-|C_1\cap C_2|=\\
            &=|C_1\cup C_2|-2
        \end{split}\]
        Отсюда
        $$
        r(C_1\cup C_2\setminus p)\leqslant|C_1\cup C_2\setminus p|-1
        $$
        А значит $C_1\cup C_2\setminus p\notin I$.
    \end{proof}
    \begin{lemma}
        Пусть $B\in\mathfrak B$, $x\notin B$. Тогда $B\cup x$ содержит единственный цикл.
    \end{lemma}
    \begin{proof}
        Пусть содержит два цикла: $C_1$ и $C_2$. Тогда $x\in C_1\cap C_2$. Тогда $C_1\cap C_2\setminus x$ должно содержать цикл, но это подмножество $B$, а значит база.
    \end{proof}
    \begin{theorem}[Сильная теорема о базах]
        $$
        \forall y\in B_2\setminus B_1~\exists x\in B_1\setminus B_2~B_1\setminus x\cup y\in\mathfrak B
        $$
    \end{theorem}
    \begin{proof}
        Рассмотрим $y\in B_2\setminus B_1$. Тогда по лемме выше $B_2\cap y$ содержит единственный цикл $C$.\\
        $C$ не может быть петлёй, а значит $\exists x\in B_1~x\in C$. А отсюда $B_1\cup y\setminus x\in\mathfrak B$.
    \end{proof}
    \begin{remark}
        Зачем в теоремах о базах, о циклах и о рангах написаны тривиальные утверждения (первые два в каждой из них)?\\
        А дело всё в том, что мы определили матроиды через независимые множества, но мы могли пойти от циклов, например. Мы могли сказать, что $(X;\mathfrak C)$ называется матроидом тогда, когда выполнена теорема о циклах. И получили бы равносильное определение (по модулю того, что нам надо построить $I$ из $\mathfrak C$, не наоборот). Или могли бы определить матроид через ранговую функцию.\\
        Если нам дано $\mathfrak B$, как получить $I$? Да легко, взять все подмножества. Как из $\mathfrak C$ получить $I$? Взять те множества, которые не содержат цикл как подмножество. А как получить $I$ из $r$? Взять множества с рангом равным мощности.
    \end{remark}
    \begin{theorem}[Аксиоматизация базами]
        Пусть $X$~--- множество, $\mathfrak B\subset 2^X$~--- такое множество, для которого выполнена слабая теорема о базах. Тогда взяв $I=\{A\mid\exists B\in\mathfrak B~A\subset B\}$, получим $(X;I)$~--- матроид с множеством баз $\mathfrak B$.
    \end{theorem}
    \begin{lemma}
        Все элементы $\mathfrak B$ равномощны. Пусть это не так, есть две базы разной мощности $B_1,B_2:|B_1|>|B_2|$. Среди всех таких па баз выберем такие, что $|B_1\cap B_2|$ максимально.\\
        Поскольку $B_2\not\subset B_1$, $\exists x\in B_2\subset B_1$, а по пункту 3 теоремы о базах это значит, что $\exists y\in B_1\setminus B_2~B_2\setminus x\cup y\in\mathfrak B$. Получили противоречие с максимальностью $|B_1\cap B_2|$.
    \end{lemma}
    \begin{proof}
        Первая и вторая аксиома матроида, очевидно, выполнены. Докажем третье. Пусть $A,B\in I:|A|>|B|$. Рассмотрим $A\subset S\in\mathfrak B$, $B\subset T\in\mathfrak B$ и среди всех таких $S,T$ выберем такие, что $|S\cap T|$ максимально.\\
        Если $T\cap A\setminus B\neq\varnothing$, то мы всё доказали.\\
        Иначе. Если $\exists x\in T\setminus(B\cap S)$, то, по третьему пункту теоремы о базах, $\exists y\in S\setminus T~T\setminus x\cup y\in\mathfrak B$. Пусть $T'=T\setminus x\cup y$, тогда $|S\cap T'|>|S\cap T|$.\\
        Если же такого $x$ не существует (то есть не только $T\cap A\setminus B=\varnothing$, но и $T\setminus S\setminus B=\varnothing$). Но это противоречит с $|A|>|B|$.\hrule
        Осталось только доказать, что полученное $I$ порождает именно $\mathfrak B$ в качестве баз. Ну, пусть он порождает $\tilde{\mathfrak B}$. Надо доказать, что $\tilde{\mathfrak B}=\mathfrak B$.\\
        Докажем $\mathfrak B\subset\tilde{\mathfrak B}$. Рассмотрим $S\in\mathfrak B$. Надо доказать, что оно максимальное по включению в $I$. Если не максимально, то есть $S\subsetneq T\in I$. Тогда $R$ лежит в некотром $R\in\mathfrak B$, но $S\subsetneq R$, и оба из $\mathfrak B$, противоречие.\\
        Докажем $\tilde{\mathfrak B}\subset\mathfrak B$. Рассмотрим $A\in\tilde{\mathfrak B}$ (а значит $\in I$). Это значит, что $\exists S\in\mathfrak B~A\subset S$. Если $A=S$, то включение доказано, если $A\neq S$, то, поскольку $S\in I$, $A$ не максимально во включению, следовательно $A\notin\tilde{\mathfrak B}$.
    \end{proof}
    \begin{theorem}[Аксиоматизация циклами]
        Пусть $\mathfrak C\subset 2^X$. И для него выполнены следующие аксиомы:
        \begin{enumerate}
            \item $\varnothing\notin\mathfrak C$.
            \item Если $C_1,C_2\in\mathfrak C$ и $C_1\neq C_2$, то $C_1\not\subset C_2$.
            \item Если $C_1,C_2\in\mathfrak C$ и $C_1\neq C_2$, то
            $$
            \forall p\in C_1\cap C_2~\exists C_3\in\mathfrak C~C_3\subset C_1\cap C_2\setminus p
            $$
        \end{enumerate}
        Тогда $\mathfrak C$ является множеством циклов некоторого матроида.
    \end{theorem}
    \begin{proof}
        Пусть
        $$
        I=\{A\mid B\subset A\Rightarrow B\not\subset\mathfrak C\}
        $$
        Первые две аксиомы матроида очевидны. А с третьим надо разбираться. Пойдём от противного. Пусть существуют $A$, $B$ такие что $|A|<|B|$ и не существует $x$ такого какого нам надо. Среди всех таких пар выберем такую, что $|A\cap B|$ минимально.\\
        Ну, хорошо. Рассмотрим $B\setminus A$. В нём конечное количество элементов, пронумеруем их.
        $$
        B\setminus A=\{p_1;\ldots;p_t\}
        $$
        Во-первых, $t\geqslant 2$ (иначе $A\subset B$).\\
        Во-вторых, $A\cap p_i\notin I$ для всех $I$, то есть $A\cap p_i$ содержит в себе цикл. Обзовём его $C_i$.\\
        Рассмотрим $C_1\subset A\cap p_1$. Заметим, что $C_1\not\subset B$. Значит $\exists q_1\in C_1\setminus B$.\\
        Рассмотрим $A\setminus q_1\cap p_1$. Дальше есть варианты:
        \begin{enumerate}
            \item $A\setminus q_1\cap p_1$ содержит цикл $\tilde C$. Тогда $p_1\in C_1\cap\tilde C$, следовательно $C_1\cap\tilde C\setminus p_1$ содержит цикл. Но это $C_1\cap\tilde C\setminus p_1\subset A$, а значит циклов там быть не может.
            \item $A\setminus q_1\cap p_1\in I$. Рассмотрим $A'=A\setminus q_1\cap p_1$. Тогда
            $$
            |A'\cup B|<|A\cap B|
            $$
            Тогда поскольку $|A'|<|B|$, $\exists q\in B\setminus A'~A'\cap q\in I$. $q$, как несложно заметить, равно некоторому $q_j$. Значит
            $$
            A\setminus q_1\cup p_1\cup p_j\in I
            $$
            Рассмотрим тогда $C_j\subset A\cup p_j$. Воспользовавшись третьей аксиомой, получим что $C_1\cap C_j\setminus q_1$ содержит цикл $\hat C$. Но тогда
            $$
            \hat C\subset C_1\cap C_j\setminus q_1\subset (A\cup p_1)\cup(A\cup p_j)\setminus q_1=A\setminus q_1\cup p_1\cup p_j
            $$
        \end{enumerate}
        Осталось доказать, что у полученного матроида множество циклов ($\tilde{\mathfrak C}$) совпадает с $\mathfrak C$. Рассмотрим $C\in\mathfrak C$. Тогда $C\notin I$ и $\forall A\subset C:A\neq C~A\in I$. Ну, отсюда $C\in\tilde{\mathfrak C}$.\\
        Пусть $C\in\tilde{\mathfrak C}$. Тогда $\exists T\subset C~T\in\mathfrak C$. Но $\forall A\subset C:A\neq C~A\in I$, следовательно $T=C$.
    \end{proof}
    \begin{theorem}[Аксиоматизация рангами]
        Пусть $r\colon 2^X\to\mathbb Z_+$. И пусть выполнены аксиомы
        \begin{enumerate}
            \item $0\leqslant r(A)\leqslant|A|$.
            \item Если $A\subset B$, то $r(A)\leqslant r(B)$.
            \item $r(A\cup B)+r(A\cap B)\leqslant r(A)+r(B)$.
        \end{enumerate}
        Тогда существует матроид, для которого $r$~--- ранговая функция.
        $$
        I=\{A\mid r(A)=|A|\}
        $$
        Без доказательства.
    \end{theorem}
    \begin{theorem}[Аксиоматизация замыканиями]
        Пусть $\operatorname{span}\colon 2^X\to 2^X$ (далее $\operatorname{span}A=\langle A\rangle$). Пусть выполнены следующие аксиомы:
        \begin{enumerate}
            \item $A\subset \langle A\rangle$.
            \item $A\subset B\Rightarrow \langle A\rangle\subset\langle B\rangle$.
            \item $\langle\langle A\rangle\rangle=\langle A\rangle$.
            \item Если $p\notin\langle A\setminus q\rangle$, то $q\notin\langle A\setminus p\rangle$.
        \end{enumerate}
        Тогда существует матроид, для которого $\operatorname{span}$~--- функция замыкания.
        $$
        I=\{A\mid\forall p\in A~p\notin\langle A\setminus p\rangle\}
        $$
        Без доказательства.
    \end{theorem}
    \paragraph{Пересечение матроидов.}
    \begin{definition}
        Пусть заданы $X$, $I\subset 2^X$. Эта пара называется пересечением матроидов $(X;I_1)$ и $(X;I_2)$, если
        $$
        I=I_1\cap I_2
        $$
    \end{definition}
    \begin{example}
        Пересечение матроидов может быть матроидом (если $I_1=I_2$, например)))
    \end{example}
    \begin{example}
        ...а может и не быть.\\
        Разноцветные леса: возьмём неориентированный граф, покрасим его рёбра в случайные цвета от 1 до $k$ и сделаем себе графовый матроид и разноцветный матроид. Если правильно покрасить, то пересечение матроидом не будет:
        \begin{figure}[H]
            \begin{tikzpicture}
                \graph[simple necklace layout,node distance=1.5cm,node sep=0mm,nodes={treenode,outer sep=0mm}]{
                    1 --[red] 2 --[red] 3 --[green] 4 --[green] 1,
                    2 --[blue] 4
                };
            \end{tikzpicture}
        \end{figure}\noindent
        Тогда взяв $A=\{12,24,34\}$ и $B=\{12,14\}$, получим, что добавить в $B$ нечего.
    \end{example}
    \begin{example}
        Возьмём паросочетания в двудольном графе $((L;R);E)$. В качестве $I_1$ возьмём множество рёбер, у которых все левые концы различны, а $I_2$~--- у которых правые концы различны. И тогда в пересечении мы будем иметь паросочетания. И хотя матроидом это не является, пример довольно показательный.
    \end{example}
    \begin{property}
        Тривиально, пересечение матроидов является предматроидом.
    \end{property}
    \begin{remark}
        Поскольку матроидом не является, жадный алгоритм не работает. Зато у нас есть пример с паросочетаниями. Мы же умеем искать максимальное паросочетание в двудольном графе...\\
        Как мы это делаем? Начнём с пустого паросочетания. Дальше будем делать следующее: рассмотрим непокрытую вершину. Если её вместе с каким-то ребром можно добавить в паросочетание, добавляем. Если нет, выкинем ребро, которое мешает нам добавить текущую вершину. Но тогда мы обидим вершину, которая была в паросочетании, поэтому после этого у неё спросим, можем ли мы добавить в паросочетание с ней кого-то другого. Делаем это рекурсивно.\\
        Переводя на язык графов, мы ищем чередующийся путь, которы начинается и кончается рёбрами не из паросочетания. Он позволяет увеличить паросочетание на один. Такой называется <<дополняющим путём>>.\\
        Переведём это на язык матроидов: пытаемся добавить элемент в первый матроид. Если нельзя~--- убираем из второго матроида и пытаемся добавить в первый два элемента. И т.д.\\
        Сделаем график замен для множества $A$ в $M_1\cap M_2$. В него входит $\vec{uv}\in A\times(X\setminus A)$, если $A\setminus u\cup v\in I_2$ и $\vec{xy}\in(X\setminus A)\times A$ аналогично. И ещё построим $S=\{x\mid A\cup x\in I\}$ и $T=\{x\mid A\cup x\in I_2\}$.\\
        Если $S\cap T\neq\varnothing$, то $\exists z\in S\cap T~A\cap z\in I$. А что если $S\cap T=\varnothing$? Давайте по рёбрам, описанным выше, найдём путь из $S$ в $T$.
    \end{remark}
    \begin{remark}
        Есть лишь проблема: это не работает. Можно придумать пример. Но оказывается, что это работает, если брать путь $S\leadsto T$ кратчайшей длины.\\
        А ещё нужно доказать, что если пути нет, то множество максимально.
    \end{remark}
    \begin{theorem}[Теорема Эдмондса~--- Лоурера]
        $$
        \max\limits_{A\in I_1\cap I_2}|A|=\min\limits_{B\subset X}(r_1(B)+r_2(X\setminus B))
        $$
    \end{theorem}
    \begin{lemma}
        $$
        \forall A\in I_1\cap I_2~\forall B\subset X~|A|\leqslant r_1(B)+r_2(X\setminus B)
        $$
    \end{lemma}
    \begin{proof}
        Очевидно,
        $$r_1(B)\geqslant|A\cap B|$$
        $$
        r_2(X\setminus B)\geqslant|A\setminus B|
        $$
    \end{proof}
    \begin{corollary}
        Если $A\in I_1\cap I_2$ и $\exists B\subset X~|A|=r_1(B)+r_2(X\setminus B)$, то $A$~--- максимальное среди $I_1\cap I_2$.
    \end{corollary}
    \begin{remark}
        Теперь запустим вот такой алгоритм:\\
        Пусть $A\in I_1\cap I_2$ изначально пусто, а на каждом шаге будем делать вот что: выделим из $X\setminus A$ $S=\{x\in X\mid A\cup x\in I_1\}$ и $T=\{x\in X\mid A\cup x\in I_2\}$. Если $S$ и $T$ пересекаются, можно добавить их пересечение в $A$ (хотя для алгоритма это, вообще говоря, не нужно).\\
        Пусть пересечения нет. Проведём такие рёбра: $\vec{uv}$, если $A\cap u\setminus v\in I_1$ и $\vec{ba}$, если $A\setminus a\cup b\in I_2$. Докажем следующее: если в полученном графе есть путь из $S$ в $T$, то взяв кратчайший путь, можно получить $A$ побольше, а если нет, то $A$ максимально.
    \end{remark}
    \begin{claim}
        Если в комментарии выше нельзя добраться из $S$ в $T$, то $A$ максимально.
    \end{claim}
    \begin{proof}
        Пусть $R_S$~--- множество тех $x\in X$, до которых можно дойти из $S$. Утверждается, что если $B=\overline{R_S}$, то $r_1(B)+r_2(X\setminus B)=|A|$.\\
        Возьмём в $B$ базу. Если это $A\cap B$, то хорошо. Иначе достроим до базы $B_1$. Если оно содержит всё $A$ и ещё какую-то вершину, её можно добавить в $A$ с сохранением независимости. Иначе есть элемент $v\in B_1\setminus A$. Давайте докидывать элементы из $A$ в $B_1$, пока они не сравняются по мощности (получим $\widetilde{B_1}$). Закончим тогда, когда получим $u\in A\setminus\widetilde{B_1}$. Но тогда по определению из $u$ в $v$ должно идти ребро, подозрительно.\\
        Итого $r_1(B)=|A\cap B|$, аналогично $r_2(B)=|A\setminus B|$.
    \end{proof}
    \begin{claim}
        Докажем утверждение про кратчайший путь.
    \end{claim}
    \begin{proof}
        рассмотрим пока один матроид. Рассмотрим $A\in I$, $X\setminus A$. Проведём ребро $\vec{uv}$, если $A\setminus u\cup v\in I$. Обозначим наш граф $G_A$.\\
        Рассмотрим произвольное $B$ той же мощности, что и $A$. Тогда $|A|=|B|$ и $|A\setminus B|=|B\setminus A|$.
        \begin{lemma}
            Если в графе $G_A$ существует единственное совершенное паросочетание на $A\oplus B$, то $B$ независимо.
        \end{lemma}
        \begin{proof}
            Ориентируем рёбра паросочетания из $X\setminus A$ в $A$, а остальные~--- направо.\\
            Утверждается, что полученный граф ациклический, так как паросочетание единственно.\\
            Сделаем в этом графе топологическую сортировку. Возьмём такую, что рёбра паросочетания рядом (чтобы не рёбра паросочетания шли от меньших номеров к большим).\\
            Пронумеруем элементы $A\setminus B$ и $B\setminus A$ (первые как $y_i$, вторые~--- как $x_i$). Если $B$ не независимо, в нём есть цикл $C$. Он точно содержит хотя бы один элемент $B$, а значит возьмём $x_i$~--- минимальный по номеру элемент $B$ из него. Утверждается, что если $x\in C\setminus x_i$, то $y_ix$~--- не ребро $G_A$. Если мы возьмём $x_{k>i}$, то это уж явно не ребро потому что топологическая сортировка. А $x_{k<i}$ мы взять не можем, потому что $x_i$~--- наименьший элемент в $C$. В таком случае $A\setminus y_i\cap x\notin I$, следовательно $r(A\setminus y_i\cup x)=|A|-1$. Отсюда $x\in \langle A\setminus y_i\rangle$. Отсюда
            $$
            C\setminus x_i\subset \langle A\setminus y_i\rangle\Rightarrow \langle C\setminus x_i\rangle\subset \langle\langle A\setminus y_i\rangle\rangle=\langle A\setminus y_i\rangle
            $$
            Известно, что
            $$
            r(C\setminus x_i\cup x_i)=r(C)=|C|-1
            $$
            А значит
            $$
            x_i\in\langle C\setminus x_i\rangle\Rightarrow x_i\in\langle A\setminus y_i\rangle\Rightarrow r(A\setminus y_i\setminus x_i)=r(A\setminus y_i)=|A|-1
            $$
            А отсюда
            $$
            A\setminus y_i\cup x_i\notin I
            $$
            Что противоречит с ребром $y_ix_i$.
        \end{proof}\noindent
        Как использовать лемму? Возьмём кратчайший путь $S\leadsto T$. Во-первых, если $S$ пересекается с $T$, путь имеет длину ноль, поэтому алгоритмически отдельно разбирать этот случай не нужно.\\
        Теперь пусть не пересекаются. Добавим в первый матроид виртуальную вершину $x$, которая не влияет на независимость: $M_1+U_{1,1}$. Если добавить этот $x$ в $A$, то всё будет хорошо. Из этого $x$ есть рёбра во все $S$, и давайте рассматривать путь не из $S$ в $T$, а из $x$ в $T$. Он тоже кратчайший, но теперь имеет чётное число рёбер. Возьмём $B$, состоящее из тех вершин $A$, которые не на пути, и тех вершин $X\setminus A$, которые на пути. Тогда $A\oplus B$~--- в точности вершины пути. В них есть полное паросочетание, но непонятно, почему единственное. Ну, если есть ещё одно, то пронумеруем вершины по удалению от $x$. В ещё одном паросочетании есть ребро, которое не является ребром первого и ведущее из вершины с меньшим номером в вершину с большим. Тогда путь можно укоротить. А такое ребро точно есть, иначе не паросочетание. Отсюда из леммы $B\in I_1$. Аналогично можно доказать, что $B\in I_2$.
    \end{proof}
    \begin{remark}
        Что делать, если матроид взвешенный? Надо на рёбрах написать стоимость замены, и искать кратчайший путь по рёбрам, а среди них~--- минимальный по весу.
    \end{remark}
    \begin{remark}
        А что делать, если надо пересекать больше двух матроидов? Тогда придётся страдать, потому что это задача NP-трудного характера. Можно свести гамильтонов путь к этой задаче: по графу построим три матроида и число $k$ такие что в графе есть гамильтонов путь тогда и только тогда, когда в пересечении $M_1$, $M_2$ и $M_3$ есть независимое множество размера $k$.\\
        Рассмотрим ориентированный граф. $M_1$~--- выходящие <<солнышки>> или <<квазидеревья>>~--- граф, у которого из каждой вершины выходит не больше одного ребра. $M_2$~--- то же самое, но в каждую вершину входит не больше одного ребра. $M_1$ и $M_2$~--- разноцветные матроиды, в первом цвет~--- номер исходящей вершины, во втором~--- входящей. Пересечение $M_1$ и $M_2$~--- пути и циклы. А $M_3$~--- графовый матроид на неориентированном графе. Тогда в пересечении трех матроидов есть множества $A$, у которых мощность~--- $n$ минус количество путей в них. Максимизируем это и скажем, что $k=n-1$. Всё.
    \end{remark}
    \begin{definition}
        Пусть $M_1=(X;I_1)$ и $M_2=(X;I_2)$~--- матроиды с одинаковым носителем. Тогда \textbf{объединение матроидов}~--- это
        $$
        M_1\cup M_1=(X;I)\mid I=\{A_1\cup A_2\mid A_1\in I,A_2\in I_2\}
        $$
    \end{definition}
    \begin{theorem}
        Объединение произвольного количества матроидов является матроидом.
    \end{theorem}
    \begin{proof}
        Возьмём $X$ и заменим его элемент $x$ на набор элементов $(x;i)$ для всех $i$ от 1 до номера последнего матроида. Тогда возьмём $M_1+M_2+\cdots M_k$~--- это точно матроид. А теперь возьмём функцию $f\colon (x;i)\mapsto x$, и $f(M_1+\cdots+M_k)=M_1\cup\cdots\cup M_k$, а применение $f$ к матроиду~--- это проекция матроида, которая тоже является матроидом.
    \end{proof}
    \begin{remark}
        Но это неконструктивно, мы так не умеем проверять, является ли $A$ независимым в объединении матроидов. А хочется.\\
        Сведём поиск максимального независимого множества в объединении (произвольного количества матроида) к поиску максимального независимого множества в пересечении двух матроидов.\\
        Задублируем $X$ $k$ раз, это будет новый носитель. И скрафтим на нём два матроида: $\widetilde{M_1}=M_1+M_2+\cdots+M_k$, а $\widetilde{M_2}$~--- разноцветный матроид. Одинаковым цветом обладают одинаковые элементы из $X$. Тогда $\widetilde{M_1}\cap\widetilde{M_2}$ состоит из тех же множеств, что и объединение.
    \end{remark}
\end{document}
